Opal.modules.benchmark=function(Opal){var $nesting=[],nil=Opal.nil,$$$=Opal.$$$,$module=Opal.module,$const_set=Opal.const_set,$send=Opal.send,$to_a=Opal.to_a,$rb_minus=Opal.rb_minus,$truthy=Opal.truthy,$rb_plus=Opal.rb_plus,$rb_times=Opal.rb_times,$def=Opal.def,$to_ary=Opal.to_ary,$klass=Opal.klass,$rb_lt=Opal.rb_lt,$alias=Opal.alias,$gvars=Opal.gvars,$hash2=Opal.hash2,$eqeqeq=Opal.eqeqeq;return Opal.add_stubs("sync,sync=,-,+,empty?,print,*,new,===,each,grep,ljust,shift,label,format,list,nil?,benchmark,to_proc,width,puts,length,inject,measure,rjust,map,start,tap,times,clock_gettime,utime,stime,cutime,cstime,module_function,raise,to_s,<,<<,attr_reader,real,memberwise,gsub,dup,%,total,protected,__send__"),function($base,$parent_nesting){var $b,self=$module($base,"Benchmark"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);return $const_set($nesting[0],"BENCHMARK_VERSION","2002-04-25"),$def(self,"$benchmark",(function $$benchmark($a,$b,$c,$d){var $post_args,caption,label_width,format,labels,$yield=$$benchmark.$$p||nil,self=this,sync=nil,$writer=nil,$ret_or_1=nil,report=nil,results=nil;return delete $$benchmark.$$p,($post_args=Opal.slice.call(arguments)).length>0&&(caption=$post_args.shift()),null==caption&&(caption=""),$post_args.length>0&&(label_width=$post_args.shift()),null==label_width&&(label_width=nil),$post_args.length>0&&(format=$post_args.shift()),null==format&&(format=nil),labels=$post_args,function(){try{return sync=$$("STDOUT").$sync(),$writer=[!0],$send($$("STDOUT"),"sync=",$to_a($writer)),$writer[$rb_minus($writer.length,1)],label_width=$truthy($ret_or_1=label_width)?$ret_or_1:0,label_width=$rb_plus(label_width,1),format=$truthy($ret_or_1=format)?$ret_or_1:$$("FORMAT"),$truthy(caption["$empty?"]())||self.$print($rb_plus($rb_times(" ",label_width),caption)),report=$$("Report").$new(label_width,format),results=Opal.yield1($yield,report),$truthy($ret_or_1=$$("Array")["$==="](results))&&$send(results.$grep($$("Tms")),"each",[],(function $$1(t){var $ret_or_2,$ret_or_3;return null==t&&(t=nil),(null==$$1.$$s?this:$$1.$$s).$print(($truthy($ret_or_2=$truthy($ret_or_3=labels.$shift())?$ret_or_3:t.$label())?$ret_or_2:"").$ljust(label_width),t.$format(format))}),{$$arity:1,$$s:self}),report.$list()}finally{$truthy(sync["$nil?"]())||($writer=[sync],$send($$("STDOUT"),"sync=",$to_a($writer)),$writer[$rb_minus($writer.length,1)])}}()}),-1),$def(self,"$bm",(function $$bm($a,$b){var $post_args,label_width,labels,blk=$$bm.$$p||nil,self=this;return delete $$bm.$$p,($post_args=Opal.slice.call(arguments)).length>0&&(label_width=$post_args.shift()),null==label_width&&(label_width=0),labels=$post_args,$send(self,"benchmark",[$$("CAPTION"),label_width,$$("FORMAT")].concat($to_a(labels)),blk.$to_proc())}),-1),$def(self,"$bmbm",(function $$bmbm(width){var $yield=$$bmbm.$$p||nil,self=this,job=nil,sync=nil,$writer=nil,ets=nil;return delete $$bmbm.$$p,null==width&&(width=0),function(){try{return job=$$("Job").$new(width),Opal.yield1($yield,job),width=$rb_plus(job.$width(),1),sync=$$("STDOUT").$sync(),$writer=[!0],$send($$("STDOUT"),"sync=",$to_a($writer)),$writer[$rb_minus($writer.length,1)],self.$puts("Rehearsal ".$ljust($rb_plus(width,$$("CAPTION").$length()),"-")),ets=$send(job.$list(),"inject",[$$("Tms").$new()],(function $$2(sum,$mlhs_tmp1){var $a,self=null==$$2.$$s?this:$$2.$$s,label=nil,item=nil,res=nil;return null==sum&&(sum=nil),null==$mlhs_tmp1&&($mlhs_tmp1=nil),label=null==($a=$to_ary($mlhs_tmp1))[0]?nil:$a[0],item=null==$a[1]?nil:$a[1],self.$print(label.$ljust(width)),res=$send($$("Benchmark"),"measure",[],item.$to_proc()),self.$print(res.$format()),$rb_plus(sum,res)}),{$$arity:2,$$s:self,$$has_top_level_mlhs_arg:!0}).$format("total: %tsec"),self.$print((" "+ets+"\n\n").$rjust($rb_plus($rb_plus(width,$$("CAPTION").$length()),2),"-")),self.$print($rb_plus($rb_times(" ",width),$$("CAPTION"))),$send(job.$list(),"map",[],(function $$3(label,item){var self=null==$$3.$$s?this:$$3.$$s;return null==label&&(label=nil),null==item&&(item=nil),$$("GC").$start(),self.$print(label.$ljust(width)),$send($send($$("Benchmark"),"measure",[label],item.$to_proc()),"tap",[],(function $$4(res){return null==res&&(res=nil),(null==$$4.$$s?this:$$4.$$s).$print(res)}),{$$arity:1,$$s:self})}),{$$arity:2,$$s:self})}finally{$truthy(sync["$nil?"]())||($writer=[sync],$send($$("STDOUT"),"sync=",$to_a($writer)),$writer[$rb_minus($writer.length,1)])}}()}),-1),$truthy(($b=$$("Process","skip_raise"))&&$$$($b,"CLOCK_MONOTONIC","skip_raise")?"constant":nil)?$const_set($nesting[0],"BENCHMARK_CLOCK",$$$($$("Process"),"CLOCK_MONOTONIC")):$const_set($nesting[0],"BENCHMARK_CLOCK",$$$($$("Process"),"CLOCK_REALTIME")),$def(self,"$measure",(function $$measure(label){var $a,r0,r1,$yield=$$measure.$$p||nil,t0=nil,t1=nil;return delete $$measure.$$p,null==label&&(label=""),t0=($a=[$$("Process").$times(),$$("Process").$clock_gettime($$("BENCHMARK_CLOCK"))])[0],r0=$a[1],Opal.yieldX($yield,[]),t1=($a=[$$("Process").$times(),$$("Process").$clock_gettime($$("BENCHMARK_CLOCK"))])[0],r1=$a[1],$$$($$("Benchmark"),"Tms").$new($rb_minus(t1.$utime(),t0.$utime()),$rb_minus(t1.$stime(),t0.$stime()),$rb_minus(t1.$cutime(),t0.$cutime()),$rb_minus(t1.$cstime(),t0.$cstime()),$rb_minus(r1,r0),label)}),-1),$def(self,"$realtime",(function $$realtime(){var r0,$yield=$$realtime.$$p||nil;return delete $$realtime.$$p,r0=$$("Process").$clock_gettime($$("BENCHMARK_CLOCK")),Opal.yieldX($yield,[]),$rb_minus($$("Process").$clock_gettime($$("BENCHMARK_CLOCK")),r0)}),0),self.$module_function("benchmark","measure","realtime","bm","bmbm"),function($base,$super,$parent_nesting){var self=$klass($base,null,"Job"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),$proto=self.$$prototype;$proto.width=$proto.list=nil,$def(self,"$initialize",(function(width){return this.width=width,this.list=[]}),1),$def(self,"$item",(function $$item(label){var w,blk=$$item.$$p||nil;return delete $$item.$$p,null==label&&(label=""),blk===nil&&this.$raise($$("ArgumentError"),"no block"),w=(label=label.$to_s()).$length(),$truthy($rb_lt(this.width,w))&&(this.width=w),this.list["$<<"]([label,blk]),this}),-1),$alias(self,"report","item"),self.$attr_reader("list"),self.$attr_reader("width")}($nesting[0],0,$nesting),function($base,$super,$parent_nesting){var self=$klass($base,null,"Report"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),$proto=self.$$prototype;$proto.width=$proto.list=$proto.format=nil,$def(self,"$initialize",(function(width,format){var $a;return null==width&&(width=0),null==format&&(format=nil),$a=[width,format,[]],this.width=$a[0],this.format=$a[1],this.list=$a[2],$a}),-1),$def(self,"$item",(function $$item($a,$b){var $post_args,label,format,blk=$$item.$$p||nil,self=this,res=nil;return delete $$item.$$p,($post_args=Opal.slice.call(arguments)).length>0&&(label=$post_args.shift()),null==label&&(label=""),format=$post_args,self.$print(label.$to_s().$ljust(self.width)),self.list["$<<"](res=$send($$("Benchmark"),"measure",[label],blk.$to_proc())),self.$print($send(res,"format",[self.format].concat($to_a(format)))),res}),-1),$alias(self,"report","item"),self.$attr_reader("list")}($nesting[0],0,$nesting),function($base,$super,$parent_nesting){var self=$klass($base,null,"Tms"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),$proto=self.$$prototype;$proto.utime=$proto.stime=$proto.cutime=$proto.cstime=$proto.label=$proto.real=nil,$const_set($nesting[0],"CAPTION","      user     system      total        real\n"),$const_set($nesting[0],"FORMAT","%10.6u %10.6y %10.6t %10.6r\n"),self.$attr_reader("utime"),self.$attr_reader("stime"),self.$attr_reader("cutime"),self.$attr_reader("cstime"),self.$attr_reader("real"),self.$attr_reader("total"),self.$attr_reader("label"),$def(self,"$initialize",(function(utime,stime,cutime,cstime,real,label){var $a;return null==utime&&(utime=0),null==stime&&(stime=0),null==cutime&&(cutime=0),null==cstime&&(cstime=0),null==real&&(real=0),null==label&&(label=nil),$a=[utime,stime,cutime,cstime,real,label.$to_s()],this.utime=$a[0],this.stime=$a[1],this.cutime=$a[2],this.cstime=$a[3],this.real=$a[4],this.label=$a[5],this.total=$rb_plus($rb_plus($rb_plus(this.utime,this.stime),this.cutime),this.cstime)}),-1),$def(self,"$add",(function $$add(){var blk=$$add.$$p||nil;return delete $$add.$$p,$rb_plus(this,$send($$("Benchmark"),"measure",[],blk.$to_proc()))}),0),$def(self,"$add!",(function $Tms_add$excl$5(){var blk=$Tms_add$excl$5.$$p||nil,t=nil;return delete $Tms_add$excl$5.$$p,t=$send($$("Benchmark"),"measure",[],blk.$to_proc()),this.utime=$rb_plus(this.$utime(),t.$utime()),this.stime=$rb_plus(this.$stime(),t.$stime()),this.cutime=$rb_plus(this.$cutime(),t.$cutime()),this.cstime=$rb_plus(this.$cstime(),t.$cstime()),this.real=$rb_plus(this.$real(),t.$real()),this}),0),$def(self,"$+",(function(other){return this.$memberwise("+",other)}),1),$def(self,"$-",(function(other){return this.$memberwise("-",other)}),1),$def(self,"$*",(function(x){return this.$memberwise("*",x)}),1),$def(self,"$/",(function(x){return this.$memberwise("/",x)}),1),$def(self,"$format",(function($a,$b){var $post_args,format,args,self=this,str=nil,$ret_or_1=nil;return($post_args=Opal.slice.call(arguments)).length>0&&(format=$post_args.shift()),null==format&&(format=nil),args=$post_args,str=$send($send($send($send($send($send($send(($truthy($ret_or_1=format)?$ret_or_1:$$("FORMAT")).$dup(),"gsub",[/(%[-+.\d]*)n/],(function $$10(){var $c,self=null==$$10.$$s?this:$$10.$$s;return((($c=$gvars["~"])===nil?nil:$c["$[]"](1))+"s")["$%"](self.$label())}),{$$arity:0,$$s:self}),"gsub",[/(%[-+.\d]*)u/],(function $$11(){var $c,self=null==$$11.$$s?this:$$11.$$s;return((($c=$gvars["~"])===nil?nil:$c["$[]"](1))+"f")["$%"](self.$utime())}),{$$arity:0,$$s:self}),"gsub",[/(%[-+.\d]*)y/],(function $$12(){var $c,self=null==$$12.$$s?this:$$12.$$s;return((($c=$gvars["~"])===nil?nil:$c["$[]"](1))+"f")["$%"](self.$stime())}),{$$arity:0,$$s:self}),"gsub",[/(%[-+.\d]*)U/],(function $$13(){var $c,self=null==$$13.$$s?this:$$13.$$s;return((($c=$gvars["~"])===nil?nil:$c["$[]"](1))+"f")["$%"](self.$cutime())}),{$$arity:0,$$s:self}),"gsub",[/(%[-+.\d]*)Y/],(function $$14(){var $c,self=null==$$14.$$s?this:$$14.$$s;return((($c=$gvars["~"])===nil?nil:$c["$[]"](1))+"f")["$%"](self.$cstime())}),{$$arity:0,$$s:self}),"gsub",[/(%[-+.\d]*)t/],(function $$15(){var $c,self=null==$$15.$$s?this:$$15.$$s;return((($c=$gvars["~"])===nil?nil:$c["$[]"](1))+"f")["$%"](self.$total())}),{$$arity:0,$$s:self}),"gsub",[/(%[-+.\d]*)r/],(function $$16(){var $c,self=null==$$16.$$s?this:$$16.$$s;return("("+(($c=$gvars["~"])===nil?nil:$c["$[]"](1))+"f)")["$%"](self.$real())}),{$$arity:0,$$s:self}),$truthy(format)?str["$%"](args):str}),-1),$def(self,"$to_s",(function(){return this.$format()}),0),$def(self,"$to_a",(function(){return[this.label,this.utime,this.stime,this.cutime,this.cstime,this.real]}),0),$def(self,"$to_h",(function(){return $hash2(["label","utime","stime","cutime","cstime","real"],{label:this.label,utime:this.utime,stime:this.stime,cutime:this.cutime,cstime:this.cstime,real:this.real})}),0),self.$protected(),$def(self,"$memberwise",(function(op,x){return $eqeqeq($$$($$("Benchmark"),"Tms"),x)?$$$($$("Benchmark"),"Tms").$new(this.$utime().$__send__(op,x.$utime()),this.$stime().$__send__(op,x.$stime()),this.$cutime().$__send__(op,x.$cutime()),this.$cstime().$__send__(op,x.$cstime()),this.$real().$__send__(op,x.$real())):$$$($$("Benchmark"),"Tms").$new(this.$utime().$__send__(op,x),this.$stime().$__send__(op,x),this.$cutime().$__send__(op,x),this.$cstime().$__send__(op,x),this.$real().$__send__(op,x))}),2)}($nesting[0],0,$nesting),$const_set($nesting[0],"CAPTION",$$$($$$($$("Benchmark"),"Tms"),"CAPTION")),$const_set($nesting[0],"FORMAT",$$$($$$($$("Benchmark"),"Tms"),"FORMAT"))}($nesting[0],$nesting)};
