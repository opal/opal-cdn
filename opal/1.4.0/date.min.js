Opal.modules.date=function(Opal){var $nesting=[],nil=Opal.nil,$$$=Opal.$$$,$klass=Opal.klass,$def=Opal.def,$eqeqeq=Opal.eqeqeq,$to_ary=Opal.to_ary,$send2=Opal.send2,$find_super=Opal.find_super,$eqeq=Opal.eqeq,$truthy=Opal.truthy,$rb_gt=Opal.rb_gt,$const_set=Opal.const_set,$rb_plus=Opal.rb_plus,$send=Opal.send,$alias=Opal.alias,$rb_minus=Opal.rb_minus,$rb_lt=Opal.rb_lt,$rb_times=Opal.rb_times;return Opal.add_stubs("include,<=>,attr_reader,nonzero?,d,zero?,new,class,-@,+@,===,coerce,==,>,+,allocate,join,compact,map,to_proc,downcase,wrap,raise,clone,jd,>>,wday,year,month,day,-,to_s,to_i,<,*,reverse,step,abs,each"),function($base,$super,$parent_nesting){var self=$klass($base,null,"Date"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);function days_in_month(year,month){return[31,year%4==0&&year%100!=0||year%400==0?29:28,31,30,31,30,31,31,30,31,30,31][month]}return self.$$prototype.date=nil,self.$include($$("Comparable")),function($base,$super,$parent_nesting){var self=$klass($base,$super,"Infinity"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);self.$$prototype.d=nil,self.$include($$("Comparable")),$def(self,"$initialize",(function(d){return null==d&&(d=1),this.d=d["$<=>"](0)}),-1),self.$attr_reader("d"),$def(self,"$zero?",(function(){return!1}),0),$def(self,"$finite?",(function(){return!1}),0),$def(self,"$infinite?",(function(){return this.$d()["$nonzero?"]()}),0),$def(self,"$nan?",(function(){return this.$d()["$zero?"]()}),0),$def(self,"$abs",(function(){return this.$class().$new()}),0),$def(self,"$-@",(function(){return this.$class().$new(this.$d()["$-@"]())}),0),$def(self,"$+@",(function(){return this.$class().$new(this.$d()["$+@"]())}),0),$def(self,"$<=>",(function(other){var $a,$b,$ret_or_1,l=nil,r=nil;if($eqeqeq($$("Infinity"),$ret_or_1=other))return this.$d()["$<=>"](other.$d());if($eqeqeq($$("Numeric"),$ret_or_1))return this.$d();try{return $b=other.$coerce(this),l=null==($a=$to_ary($b))[0]?nil:$a[0],r=null==$a[1]?nil:$a[1],l["$<=>"](r)}catch($err){if(!Opal.rescue($err,[$$("NoMethodError")]))throw $err;try{return nil}finally{Opal.pop_exception()}}}),1),$def(self,"$coerce",(function $$coerce(other){var $yield=$$coerce.$$p||nil;return delete $$coerce.$$p,$eqeqeq($$("Numeric"),other)?[this.$d()["$-@"](),this.$d()]:$send2(this,$find_super(this,"coerce",$$coerce,!1,!0),"coerce",[other],$yield)}),1),$def(self,"$to_f",(function(){return $eqeq(this.d,0)?0:$truthy($rb_gt(this.d,0))?$$$($$("Float"),"INFINITY"):$$$($$("Float"),"INFINITY")["$-@"]()}),0)}($nesting[0],$$("Numeric"),$nesting),$const_set($nesting[0],"JULIAN",$$("Infinity").$new()),$const_set($nesting[0],"GREGORIAN",$$("Infinity").$new()["$-@"]()),$const_set($nesting[0],"ITALY",2299161),$const_set($nesting[0],"ENGLAND",2361222),$const_set($nesting[0],"MONTHNAMES",$rb_plus([nil],["January","February","March","April","May","June","July","August","September","October","November","December"])),$const_set($nesting[0],"ABBR_MONTHNAMES",["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"]),$const_set($nesting[0],"DAYNAMES",["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]),$const_set($nesting[0],"ABBR_DAYNAMES",["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]),function(self,$parent_nesting){var $nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);$def(self,"$wrap",(function(native$){var instance=nil;return(instance=this.$allocate()).date=native$,instance}),1),$def(self,"$parse",(function(string,comp){null==comp&&(comp=!0);var current_date=new Date,current_day=current_date.getDate(),current_month=current_date.getMonth(),current_year=current_date.getFullYear(),current_wday=current_date.getDay(),full_month_name_regexp=$$("MONTHNAMES").$compact().$join("|");function match1(match){return match[1]}function match2(match){return match[2]}function match3(match){return match[3]}function match4(match){return match[4]}function fromShortYear(fn){return function(match){var short_year=fn(match);return short_year+=short_year>=69?1900:2e3}}function fromMonthAbbr(fn){return function(match){var abbr=fn(match).toLowerCase();return $$("ABBR_MONTHNAMES").indexOf(abbr)+1}}function toInt(fn){return function(match){var value=fn(match);return parseInt(value,10)}}function fromFullMonthName(fn){return function(match){var month_name=fn(match);return $send($$("MONTHNAMES").$compact(),"map",[],"downcase".$to_proc()).indexOf(month_name.$downcase())+1}}var fn,rule,i,match,rules=[{regexp:/^(\d{2})$/,year:current_year,month:current_month,day:toInt(match1)},{regexp:/^(\d{3})$/,year:current_year,month:0,day:toInt(match1)},{regexp:/^(\d{2})(\d{2})$/,year:current_year,month:toInt(match1),day:toInt(match2)},{regexp:/^(\d{2})(\d{3})$/,year:fromShortYear(toInt(match1)),month:0,day:toInt(match2)},{regexp:/^(\d{2})(\d{2})(\d{2})$/,year:fromShortYear(toInt(match1)),month:toInt(match2),day:toInt(match3)},{regexp:/^(\d{4})(\d{3})$/,year:toInt(match1),month:0,day:toInt(match2)},{regexp:/^(\d{4})(\d{2})(\d{2})$/,year:toInt(match1),month:toInt(match2),day:toInt(match3)},{regexp:/^([a-z]{3})[\s\.\/\-](\d{3,4})$/,year:toInt(match2),month:fromMonthAbbr(match1),day:1},{regexp:/^(\d{1,2})[\s\.\/\-]([a-z]{3})[\s\.\/\-](\d{3,4})$/i,year:toInt(match3),month:fromMonthAbbr(match2),day:toInt(match1)},{regexp:/^([a-z]{3})[\s\.\/\-](\d{1,2})[\s\.\/\-](\d{3,4})$/i,year:toInt(match3),month:fromMonthAbbr(match1),day:toInt(match2)},{regexp:/^(\d{3,4})[\s\.\/\-]([a-z]{3})[\s\.\/\-](\d{1,2})$/i,year:toInt(match1),month:fromMonthAbbr(match2),day:toInt(match3)},{regexp:/^(\-?\d{3,4})[\s\.\/\-](\d{1,2})[\s\.\/\-](\d{1,2})$/,year:toInt(match1),month:toInt(match2),day:toInt(match3)},{regexp:/^(\d{2})[\s\.\/\-](\d{1,2})[\s\.\/\-](\d{1,2})$/,year:(fn=toInt(match1),function(match){var value=fn(match);return comp?value+2e3:value}),month:toInt(match2),day:toInt(match3)},{regexp:/^(\d{1,2})[\s\.\/\-](\d{1,2})[\s\.\/\-](\-?\d{3,4})$/,year:toInt(match3),month:toInt(match2),day:toInt(match1)},{regexp:new RegExp("^("+$$("DAYNAMES").$join("|")+")$","i"),year:current_year,month:current_month,day:function(fn){return function(match){var dayname=fn(match),wday=$send($$("DAYNAMES"),"map",[],"downcase".$to_proc()).indexOf(dayname.$downcase());return current_day-current_wday+wday}}(match1)},{regexp:new RegExp("^("+full_month_name_regexp+")[\\s\\.\\/\\-](\\d{1,2})(th|nd|rd)[\\s\\.\\/\\-](\\-?\\d{3,4})$","i"),year:toInt(match4),month:fromFullMonthName(match1),day:toInt(match2)},{regexp:new RegExp("^("+full_month_name_regexp+")[\\s\\.\\/\\-](\\d{1,2})(th|nd|rd)","i"),year:current_year,month:fromFullMonthName(match1),day:toInt(match2)},{regexp:new RegExp("^(\\d{1,2})(th|nd|rd)[\\s\\.\\/\\-]("+full_month_name_regexp+")[\\s\\.\\/\\-](\\-?\\d{3,4})$","i"),year:toInt(match4),month:fromFullMonthName(match3),day:toInt(match1)},{regexp:new RegExp("^(\\-?\\d{3,4})[\\s\\.\\/\\-]("+full_month_name_regexp+")[\\s\\.\\/\\-](\\d{1,2})(th|nd|rd)$","i"),year:toInt(match1),month:fromFullMonthName(match2),day:toInt(match3)}];for(i=0;i<rules.length;i++)if(match=(rule=rules[i]).regexp.exec(string)){var year=rule.year;"function"==typeof year&&(year=year(match));var month=rule.month;"function"==typeof month&&(month=month(match)-1);var day=rule.day;"function"==typeof day&&(day=day(match));var result=new Date(year,month,day);return year>=0&&year<=1970&&result.setFullYear(year),this.$wrap(result)}return this.$raise($$("ArgumentError"),"invalid date")}),-2),$def(self,"$today",(function(){return this.$wrap(new Date)}),0),$def(self,"$gregorian_leap?",(function(year){return new Date(year,1,29).getMonth()-1==0}),1),$alias(self,"civil","new")}(Opal.get_singleton_class(self),$nesting),$def(self,"$initialize",(function(year,month,day,start){return null==year&&(year=-4712),null==month&&(month=1),null==day&&(day=1),null==start&&(start=$$("ITALY")),1582===year&&10===month&&day>4&&day<15&&(day=4),this.date=new Date(year,month-1,day)}),-1),$def(self,"$-",(function(date){if(date.$$is_number){var result=this.$clone();return result.date.setDate(this.date.getDate()-date),result}if(date.date)return Math.round((this.date-date.date)/864e5);this.$raise($$("TypeError"))}),1),$def(self,"$+",(function(date){if(date.$$is_number){var result=this.$clone();return result.date.setDate(this.date.getDate()+date),result}this.$raise($$("TypeError"))}),1),$def(self,"$<",(function(other){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),a<b}),1),$def(self,"$<=",(function(other){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),a<=b}),1),$def(self,"$>",(function(other){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),a>b}),1),$def(self,"$>=",(function(other){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),a>=b}),1),$def(self,"$<=>",(function(other){if(other.$$is_number)return this.$jd()["$<=>"](other);if($$("Date")["$==="](other)){var a=this.date,b=other.date;return a.setHours(0,0,0,0),b.setHours(0,0,0,0),a<b?-1:a>b?1:0}return nil}),1),$def(self,"$>>",(function(n){n.$$is_number||this.$raise($$("TypeError"));var result=this.$clone(),date=result.date,cur=date.getDate();return date.setDate(1),date.setMonth(date.getMonth()+n),date.setDate(Math.min(cur,days_in_month(date.getFullYear(),date.getMonth()))),result}),1),$def(self,"$<<",(function(n){return n.$$is_number||this.$raise($$("TypeError")),this["$>>"](-n)}),1),$def(self,"$clone",(function(){return $$("Date").$wrap(new Date(this.date.getTime()))}),0),$def(self,"$day",(function(){return this.date.getDate()}),0),$def(self,"$friday?",(function(){return this.$wday()["$=="](5)}),0),$def(self,"$jd",(function(){var ggg,s,a,j1,jd,mm=this.date.getMonth()+1,dd=this.date.getDate(),yy=this.date.getFullYear(),hr=12;return hr=hr+0+0,ggg=1,yy<=1585&&(ggg=0),jd=-1*Math.floor(7*(Math.floor((mm+9)/12)+yy)/4),s=1,mm-9<0&&(s=-1),a=Math.abs(mm-9),j1=Math.floor(yy+s*Math.floor(a/7)),j1=-1*Math.floor(3*(Math.floor(j1/100)+1)/4),jd=(jd=jd+Math.floor(275*mm/9)+dd+ggg*j1)+1721027+2*ggg+367*yy-.5,jd+=hr/24}),0),$def(self,"$julian?",(function(){return this.date<new Date(1582,9,15,12)}),0),$def(self,"$monday?",(function(){return this.$wday()["$=="](1)}),0),$def(self,"$month",(function(){return this.date.getMonth()+1}),0),$def(self,"$next",(function(){return $rb_plus(this,1)}),0),$def(self,"$next_day",(function(n){return null==n&&(n=1),$rb_plus(this,n)}),-1),$def(self,"$next_month",(function(n){null==n&&(n=1);var result=this.$clone(),date=result.date,cur=date.getDate();return date.setDate(1),date.setMonth(date.getMonth()+n),date.setDate(Math.min(cur,days_in_month(date.getFullYear(),date.getMonth()))),result}),-1),$def(self,"$next_year",(function(years){return null==years&&(years=1),this.$class().$new($rb_plus(this.$year(),years),this.$month(),this.$day())}),-1),$def(self,"$prev_day",(function(n){return null==n&&(n=1),$rb_minus(this,n)}),-1),$def(self,"$prev_month",(function(n){null==n&&(n=1);var result=this.$clone(),date=result.date,cur=date.getDate();return date.setDate(1),date.setMonth(date.getMonth()-n),date.setDate(Math.min(cur,days_in_month(date.getFullYear(),date.getMonth()))),result}),-1),$def(self,"$prev_year",(function(years){return null==years&&(years=1),this.$class().$new($rb_minus(this.$year(),years),this.$month(),this.$day())}),-1),$def(self,"$saturday?",(function(){return this.$wday()["$=="](6)}),0),$def(self,"$strftime",(function(format){return null==format&&(format=""),""==format?this.$to_s():this.date.$strftime(format)}),-1),$def(self,"$sunday?",(function(){return this.$wday()["$=="](0)}),0),$def(self,"$thursday?",(function(){return this.$wday()["$=="](4)}),0),$def(self,"$to_s",(function(){var d=this.date,year=d.getFullYear(),month=d.getMonth()+1,day=d.getDate();return month<10&&(month="0"+month),day<10&&(day="0"+day),year+"-"+month+"-"+day}),0),$def(self,"$to_time",(function(){return $$("Time").$new(this.$year(),this.$month(),this.$day())}),0),$def(self,"$to_n",(function(){return this.date}),0),$def(self,"$tuesday?",(function(){return this.$wday()["$=="](2)}),0),$def(self,"$step",(function $$step(limit,step){var steps,result,block=$$step.$$p||nil,steps_count=nil;return delete $$step.$$p,null==step&&(step=1),steps_count=$rb_minus(limit,this).$to_i(),steps=$truthy($rb_lt($rb_times(steps_count,step),0))?[]:$truthy($rb_lt(steps_count,0))?$send(Opal.Range.$new(0,steps_count["$-@"](),!1).$step(step.$abs()),"map",[],"-@".$to_proc()).$reverse():Opal.Range.$new(0,steps_count,!1).$step(step.$abs()),result=$send(steps,"map",[],(function $$25(i){return null==i&&(i=nil),$rb_plus(null==$$25.$$s?this:$$25.$$s,i)}),{$$arity:1,$$s:this}),block!==nil?($send(result,"each",[],(function(i){return null==i&&(i=nil),Opal.yield1(block,i)}),1),this):result}),-2),$def(self,"$upto",(function $$upto(max){var block=$$upto.$$p||nil;return delete $$upto.$$p,$send(this,"step",[max,1],block.$to_proc())}),1),$def(self,"$downto",(function $$downto(min){var block=$$downto.$$p||nil;return delete $$downto.$$p,$send(this,"step",[min,-1],block.$to_proc())}),1),$def(self,"$wday",(function(){return this.date.getDay()}),0),$def(self,"$wednesday?",(function(){return this.$wday()["$=="](3)}),0),$def(self,"$year",(function(){return this.date.getFullYear()}),0),$def(self,"$cwday",(function(){return this.date.getDay()||7}),0),$def(self,"$cweek",(function(){var d=new Date(this.date);return d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7)),Math.ceil(((d-new Date(d.getFullYear(),0,1))/864e5+1)/7)}),0),$alias(self,"eql?","=="),$alias(self,"succ","next")}($nesting[0],0,$nesting)};
