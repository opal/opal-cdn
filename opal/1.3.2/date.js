Opal.modules["date"] = function(Opal) {/* Generated by Opal 1.3.2 */
  function $rb_gt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs > rhs : lhs['$>'](rhs);
  }
  function $rb_plus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);
  }
  function $rb_minus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);
  }
  function $rb_lt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs < rhs : lhs['$<'](rhs);
  }
  function $rb_times(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs * rhs : lhs['$*'](rhs);
  }
  var self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.$$$, $$ = Opal.$$, $klass = Opal.klass, $send2 = Opal.send2, $find_super = Opal.find_super, $truthy = Opal.truthy, $alias = Opal.alias, $send = Opal.send;

  Opal.add_stubs(['$include', '$<=>', '$attr_reader', '$nonzero?', '$d', '$zero?', '$new', '$class', '$-@', '$+@', '$===', '$coerce', '$==', '$>', '$+', '$allocate', '$join', '$compact', '$map', '$to_proc', '$downcase', '$wrap', '$raise', '$clone', '$jd', '$>>', '$wday', '$year', '$month', '$day', '$-', '$to_s', '$to_i', '$<', '$*', '$reverse', '$step', '$abs', '$each']);
  return (function($base, $super, $parent_nesting) {
    var self = $klass($base, $super, 'Date');

    var $nesting = [self].concat($parent_nesting), $Date_initialize$16, $Date_$minus$17, $Date_$plus$18, $Date_$lt$19, $Date_$lt_eq$20, $Date_$gt$21, $Date_$gt_eq$22, $Date_$lt_eq_gt$23, $Date_$gt$gt$24, $Date_$lt$lt$25, $Date_clone$26, $Date_day$27, $Date_friday$ques$28, $Date_jd$29, $Date_julian$ques$30, $Date_monday$ques$31, $Date_month$32, $Date_next$33, $Date_next_day$34, $Date_next_month$35, $Date_next_year$36, $Date_prev_day$37, $Date_prev_month$38, $Date_prev_year$39, $Date_saturday$ques$40, $Date_strftime$41, $Date_sunday$ques$42, $Date_thursday$ques$43, $Date_to_s$44, $Date_to_time$45, $Date_to_n$46, $Date_tuesday$ques$47, $Date_step$48, $Date_upto$51, $Date_downto$52, $Date_wday$53, $Date_wednesday$ques$54, $Date_year$55, $Date_cwday$56, $Date_cweek$57;

    self.$$prototype.date = nil;
    
    self.$include($$($nesting, 'Comparable'));
    (function($base, $super, $parent_nesting) {
      var self = $klass($base, $super, 'Infinity');

      var $nesting = [self].concat($parent_nesting), $Infinity_initialize$1, $Infinity_zero$ques$2, $Infinity_finite$ques$3, $Infinity_infinite$ques$4, $Infinity_nan$ques$5, $Infinity_abs$6, $Infinity_$minus$$7, $Infinity_$plus$$8, $Infinity_$lt_eq_gt$9, $Infinity_coerce$10, $Infinity_to_f$11;

      self.$$prototype.d = nil;
      
      self.$include($$($nesting, 'Comparable'));
      
      Opal.def(self, '$initialize', $Infinity_initialize$1 = function $$initialize(d) {
        var self = this;

        
        
        if (d == null) {
          d = 1;
        };
        return (self.d = d['$<=>'](0));
      }, $Infinity_initialize$1.$$arity = -1);
      self.$attr_reader("d");
      
      Opal.def(self, '$zero?', $Infinity_zero$ques$2 = function() {
        var self = this;

        return false
      }, $Infinity_zero$ques$2.$$arity = 0);
      
      Opal.def(self, '$finite?', $Infinity_finite$ques$3 = function() {
        var self = this;

        return false
      }, $Infinity_finite$ques$3.$$arity = 0);
      
      Opal.def(self, '$infinite?', $Infinity_infinite$ques$4 = function() {
        var self = this;

        return self.$d()['$nonzero?']()
      }, $Infinity_infinite$ques$4.$$arity = 0);
      
      Opal.def(self, '$nan?', $Infinity_nan$ques$5 = function() {
        var self = this;

        return self.$d()['$zero?']()
      }, $Infinity_nan$ques$5.$$arity = 0);
      
      Opal.def(self, '$abs', $Infinity_abs$6 = function $$abs() {
        var self = this;

        return self.$class().$new()
      }, $Infinity_abs$6.$$arity = 0);
      
      Opal.def(self, '$-@', $Infinity_$minus$$7 = function() {
        var self = this;

        return self.$class().$new(self.$d()['$-@']())
      }, $Infinity_$minus$$7.$$arity = 0);
      
      Opal.def(self, '$+@', $Infinity_$plus$$8 = function() {
        var self = this;

        return self.$class().$new(self.$d()['$+@']())
      }, $Infinity_$plus$$8.$$arity = 0);
      
      Opal.def(self, '$<=>', $Infinity_$lt_eq_gt$9 = function(other) {
        var $a, $b, self = this, $case = nil, l = nil, r = nil;

        return (function() {$case = other;
        if ($$($nesting, 'Infinity')['$===']($case)) {return self.$d()['$<=>'](other.$d())}
        else if ($$($nesting, 'Numeric')['$===']($case)) {return self.$d()}
        else {
        try {
          
          $b = other.$coerce(self), $a = Opal.to_ary($b), (l = ($a[0] == null ? nil : $a[0])), (r = ($a[1] == null ? nil : $a[1])), $b;
          return l['$<=>'](r);
        } catch ($err) {
          if (Opal.rescue($err, [$$($nesting, 'NoMethodError')])) {
            try {
              return nil
            } finally { Opal.pop_exception(); }
          } else { throw $err; }
        };}})()
      }, $Infinity_$lt_eq_gt$9.$$arity = 1);
      
      Opal.def(self, '$coerce', $Infinity_coerce$10 = function $$coerce(other) {
        var $iter = $Infinity_coerce$10.$$p, $yield = $iter || nil, self = this, $case = nil;

        if ($iter) $Infinity_coerce$10.$$p = null;
        return (function() {$case = other;
        if ($$($nesting, 'Numeric')['$===']($case)) {return [self.$d()['$-@'](), self.$d()]}
        else {return $send2(self, $find_super(self, 'coerce', $Infinity_coerce$10, false, true), 'coerce', [other], $iter)}})()
      }, $Infinity_coerce$10.$$arity = 1);
      return (Opal.def(self, '$to_f', $Infinity_to_f$11 = function $$to_f() {
        var self = this;

        
        if (self.d['$=='](0)) {
          return 0};
        if ($truthy($rb_gt(self.d, 0))) {
          return $$$($$($nesting, 'Float'), 'INFINITY')
        } else {
          return $$$($$($nesting, 'Float'), 'INFINITY')['$-@']()
        };
      }, $Infinity_to_f$11.$$arity = 0), nil) && 'to_f';
    })($nesting[0], $$($nesting, 'Numeric'), $nesting);
    Opal.const_set($nesting[0], 'JULIAN', $$($nesting, 'Infinity').$new());
    Opal.const_set($nesting[0], 'GREGORIAN', $$($nesting, 'Infinity').$new()['$-@']());
    Opal.const_set($nesting[0], 'ITALY', 2299161);
    Opal.const_set($nesting[0], 'ENGLAND', 2361222);
    Opal.const_set($nesting[0], 'MONTHNAMES', $rb_plus([nil], ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]));
    Opal.const_set($nesting[0], 'ABBR_MONTHNAMES', ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"]);
    Opal.const_set($nesting[0], 'DAYNAMES', ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]);
    Opal.const_set($nesting[0], 'ABBR_DAYNAMES', ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]);
    (function(self, $parent_nesting) {
      var $nesting = [self].concat($parent_nesting), $wrap$12, $parse$13, $today$14, $gregorian_leap$ques$15;

      
      $alias(self, "civil", "new");
      
      Opal.def(self, '$wrap', $wrap$12 = function $$wrap(native$) {
        var self = this, instance = nil;

        
        instance = self.$allocate();
        instance.date = native$;
        return instance;
      }, $wrap$12.$$arity = 1);
      
      Opal.def(self, '$parse', $parse$13 = function $$parse(string, comp) {
        var self = this;

        
        
        if (comp == null) {
          comp = true;
        };
        
        var current_date = new Date();

        var current_day = current_date.getDate(),
            current_month = current_date.getMonth(),
            current_year = current_date.getFullYear(),
            current_wday = current_date.getDay(),
            full_month_name_regexp = $$($nesting, 'MONTHNAMES').$compact().$join("|");

        function match1(match) { return match[1]; }
        function match2(match) { return match[2]; }
        function match3(match) { return match[3]; }
        function match4(match) { return match[4]; }

        // Converts passed short year (0..99)
        // to a 4-digits year in the range (1969..2068)
        function fromShortYear(fn) {
          return function(match) {
            var short_year = fn(match);

            if (short_year >= 69) {
              short_year += 1900;
            } else {
              short_year += 2000;
            }
            return short_year;
          }
        }

        // Converts month abbr (nov) to a month number
        function fromMonthAbbr(fn) {
          return function(match) {
            var abbr = fn(match).toLowerCase();
            return $$($nesting, 'ABBR_MONTHNAMES').indexOf(abbr) + 1;
          }
        }

        function toInt(fn) {
          return function(match) {
            var value = fn(match);
            return parseInt(value, 10);
          }
        }

        // Depending on the 'comp' value appends 20xx to a passed year
        function to2000(fn) {
          return function(match) {
            var value = fn(match);
            if (comp) {
              return value + 2000;
            } else {
              return value;
            }
          }
        }

        // Converts passed week day name to a day number
        function fromDayName(fn) {
          return function(match) {
            var dayname = fn(match),
                wday = $send($$($nesting, 'DAYNAMES'), 'map', [], "downcase".$to_proc()).indexOf((dayname).$downcase());

            return current_day - current_wday + wday;
          }
        }

        // Converts passed month name to a month number
        function fromFullMonthName(fn) {
          return function(match) {
            var month_name = fn(match);
            return $send($$($nesting, 'MONTHNAMES').$compact(), 'map', [], "downcase".$to_proc()).indexOf((month_name).$downcase()) + 1;
          }
        }

        var rules = [
          {
            // DD as month day number
            regexp: /^(\d{2})$/,
            year: current_year,
            month: current_month,
            day: toInt(match1)
          },
          {
            // DDD as year day number
            regexp: /^(\d{3})$/,
            year: current_year,
            month: 0,
            day: toInt(match1)
          },
          {
            // MMDD as month and day
            regexp: /^(\d{2})(\d{2})$/,
            year: current_year,
            month: toInt(match1),
            day: toInt(match2)
          },
          {
            // YYDDD as year and day number in 1969--2068
            regexp: /^(\d{2})(\d{3})$/,
            year: fromShortYear(toInt(match1)),
            month: 0,
            day: toInt(match2)
          },
          {
            // YYMMDD as year, month and day in 1969--2068
            regexp: /^(\d{2})(\d{2})(\d{2})$/,
            year: fromShortYear(toInt(match1)),
            month: toInt(match2),
            day: toInt(match3)
          },
          {
            // YYYYDDD as year and day number
            regexp: /^(\d{4})(\d{3})$/,
            year: toInt(match1),
            month: 0,
            day: toInt(match2)
          },
          {
            // YYYYMMDD as year, month and day number
            regexp: /^(\d{4})(\d{2})(\d{2})$/,
            year: toInt(match1),
            month: toInt(match2),
            day: toInt(match3)
          },
          {
            // mmm YYYY
            regexp: /^([a-z]{3})[\s\.\/\-](\d{3,4})$/,
            year: toInt(match2),
            month: fromMonthAbbr(match1),
            day: 1
          },
          {
            // DD mmm YYYY
            regexp: /^(\d{1,2})[\s\.\/\-]([a-z]{3})[\s\.\/\-](\d{3,4})$/i,
            year: toInt(match3),
            month: fromMonthAbbr(match2),
            day: toInt(match1)
          },
          {
            // mmm DD YYYY
            regexp: /^([a-z]{3})[\s\.\/\-](\d{1,2})[\s\.\/\-](\d{3,4})$/i,
            year: toInt(match3),
            month: fromMonthAbbr(match1),
            day: toInt(match2)
          },
          {
            // YYYY mmm DD
            regexp: /^(\d{3,4})[\s\.\/\-]([a-z]{3})[\s\.\/\-](\d{1,2})$/i,
            year: toInt(match1),
            month: fromMonthAbbr(match2),
            day: toInt(match3)
          },
          {
            // YYYY-MM-DD YYYY/MM/DD YYYY.MM.DD
            regexp: /^(\-?\d{3,4})[\s\.\/\-](\d{1,2})[\s\.\/\-](\d{1,2})$/,
            year: toInt(match1),
            month: toInt(match2),
            day: toInt(match3)
          },
          {
            // YY-MM-DD
            regexp: /^(\d{2})[\s\.\/\-](\d{1,2})[\s\.\/\-](\d{1,2})$/,
            year: to2000(toInt(match1)),
            month: toInt(match2),
            day: toInt(match3)
          },
          {
            // DD-MM-YYYY
            regexp: /^(\d{1,2})[\s\.\/\-](\d{1,2})[\s\.\/\-](\-?\d{3,4})$/,
            year: toInt(match3),
            month: toInt(match2),
            day: toInt(match1)
          },
          {
            // ddd
            regexp: new RegExp("^(" + $$($nesting, 'DAYNAMES').$join("|") + ")$", 'i'),
            year: current_year,
            month: current_month,
            day: fromDayName(match1)
          },
          {
            // monthname daynumber YYYY
            regexp: new RegExp("^(" + full_month_name_regexp + ")[\\s\\.\\/\\-](\\d{1,2})(th|nd|rd)[\\s\\.\\/\\-](\\-?\\d{3,4})$", "i"),
            year: toInt(match4),
            month: fromFullMonthName(match1),
            day: toInt(match2)
          },
          {
            // monthname daynumber
            regexp: new RegExp("^(" + full_month_name_regexp + ")[\\s\\.\\/\\-](\\d{1,2})(th|nd|rd)", "i"),
            year: current_year,
            month: fromFullMonthName(match1),
            day: toInt(match2)
          },
          {
            // daynumber monthname YYYY
            regexp: new RegExp("^(\\d{1,2})(th|nd|rd)[\\s\\.\\/\\-](" + full_month_name_regexp + ")[\\s\\.\\/\\-](\\-?\\d{3,4})$", "i"),
            year: toInt(match4),
            month: fromFullMonthName(match3),
            day: toInt(match1)
          },
          {
            // YYYY monthname daynumber
            regexp: new RegExp("^(\\-?\\d{3,4})[\\s\\.\\/\\-](" + full_month_name_regexp + ")[\\s\\.\\/\\-](\\d{1,2})(th|nd|rd)$", "i"),
            year: toInt(match1),
            month: fromFullMonthName(match2),
            day: toInt(match3)
          }
        ]

        var rule, i, match;

        for (i = 0; i < rules.length; i++) {
          rule = rules[i];
          match = rule.regexp.exec(string);
          if (match) {
            var year = rule.year;
            if (typeof(year) === 'function') {
              year = year(match);
            }

            var month = rule.month;
            if (typeof(month) === 'function') {
              month = month(match) - 1
            }

            var day = rule.day;
            if (typeof(day) === 'function') {
              day = day(match);
            }

            var result = new Date(year, month, day);

            // an edge case, JS can't handle 'new Date(1)', minimal year is 1970
            if (year >= 0 && year <= 1970) {
              result.setFullYear(year);
            }

            return self.$wrap(result);
          }
        }
      ;
        return self.$raise($$($nesting, 'ArgumentError'), "invalid date");
      }, $parse$13.$$arity = -2);
      
      Opal.def(self, '$today', $today$14 = function $$today() {
        var self = this;

        return self.$wrap(new Date())
      }, $today$14.$$arity = 0);
      return (Opal.def(self, '$gregorian_leap?', $gregorian_leap$ques$15 = function(year) {
        var self = this;

        return (new Date(year, 1, 29).getMonth()-1) === 0
      }, $gregorian_leap$ques$15.$$arity = 1), nil) && 'gregorian_leap?';
    })(Opal.get_singleton_class(self), $nesting);
    
    Opal.def(self, '$initialize', $Date_initialize$16 = function $$initialize(year, month, day, start) {
      var self = this;

      
      
      if (year == null) {
        year = -4712;
      };
      
      if (month == null) {
        month = 1;
      };
      
      if (day == null) {
        day = 1;
      };
      
      if (start == null) {
        start = $$($nesting, 'ITALY');
      };
      
      // Because of Gregorian reform calendar goes from 1582-10-04 to 1582-10-15.
      // All days in between end up as 4 october.
      if (year === 1582 && month === 10 && day > 4 && day < 15) {
        day = 4;
      }
    ;
      return (self.date = new Date(year, month - 1, day));
    }, $Date_initialize$16.$$arity = -1);
    
    Opal.def(self, '$-', $Date_$minus$17 = function(date) {
      var self = this;

      
      if (date.$$is_number) {
        var result = self.$clone();
        result.date.setDate(self.date.getDate() - date);
        return result;
      }
      else if (date.date) {
        return Math.round((self.date - date.date) / (1000 * 60 * 60 * 24));
      }
      else {
        self.$raise($$($nesting, 'TypeError'));
      }
    
    }, $Date_$minus$17.$$arity = 1);
    
    Opal.def(self, '$+', $Date_$plus$18 = function(date) {
      var self = this;

      
      if (date.$$is_number) {
        var result = self.$clone();
        result.date.setDate(self.date.getDate() + date);
        return result;
      }
      else {
        self.$raise($$($nesting, 'TypeError'));
      }
    
    }, $Date_$plus$18.$$arity = 1);
    
    Opal.def(self, '$<', $Date_$lt$19 = function(other) {
      var self = this;

      
      var a = self.date, b = other.date;
      a.setHours(0, 0, 0, 0);
      b.setHours(0, 0, 0, 0);
      return a < b;
    
    }, $Date_$lt$19.$$arity = 1);
    
    Opal.def(self, '$<=', $Date_$lt_eq$20 = function(other) {
      var self = this;

      
      var a = self.date, b = other.date;
      a.setHours(0, 0, 0, 0);
      b.setHours(0, 0, 0, 0);
      return a <= b;
    
    }, $Date_$lt_eq$20.$$arity = 1);
    
    Opal.def(self, '$>', $Date_$gt$21 = function(other) {
      var self = this;

      
      var a = self.date, b = other.date;
      a.setHours(0, 0, 0, 0);
      b.setHours(0, 0, 0, 0);
      return a > b;
    
    }, $Date_$gt$21.$$arity = 1);
    
    Opal.def(self, '$>=', $Date_$gt_eq$22 = function(other) {
      var self = this;

      
      var a = self.date, b = other.date;
      a.setHours(0, 0, 0, 0);
      b.setHours(0, 0, 0, 0);
      return a >= b;
    
    }, $Date_$gt_eq$22.$$arity = 1);
    
    Opal.def(self, '$<=>', $Date_$lt_eq_gt$23 = function(other) {
      var self = this;

      
      if (other.$$is_number) {
        return self.$jd()['$<=>'](other)
      }

      if ($$($nesting, 'Date')['$==='](other)) {
        var a = self.date, b = other.date;
        a.setHours(0, 0, 0, 0);
        b.setHours(0, 0, 0, 0);

        if (a < b) {
          return -1;
        }
        else if (a > b) {
          return 1;
        }
        else {
          return 0;
        }
      } else {
        return nil;
      }
    
    }, $Date_$lt_eq_gt$23.$$arity = 1);
    
    Opal.def(self, '$>>', $Date_$gt$gt$24 = function(n) {
      var self = this;

      
      if (!n.$$is_number) {
        self.$raise($$($nesting, 'TypeError'));
      }

      var result = self.$clone(), date = result.date, cur = date.getDate();
      date.setDate(1);
      date.setMonth(date.getMonth() + n);
      date.setDate(Math.min(cur, days_in_month(date.getFullYear(), date.getMonth())));
      return result;
    
    }, $Date_$gt$gt$24.$$arity = 1);
    
    Opal.def(self, '$<<', $Date_$lt$lt$25 = function(n) {
      var self = this;

      
      if (!n.$$is_number) {
        self.$raise($$($nesting, 'TypeError'));
      }

      return self['$>>'](-n);
    
    }, $Date_$lt$lt$25.$$arity = 1);
    $alias(self, "eql?", "==");
    
    Opal.def(self, '$clone', $Date_clone$26 = function $$clone() {
      var self = this;

      return $$($nesting, 'Date').$wrap(new Date(self.date.getTime()))
    }, $Date_clone$26.$$arity = 0);
    
    Opal.def(self, '$day', $Date_day$27 = function $$day() {
      var self = this;

      return self.date.getDate()
    }, $Date_day$27.$$arity = 0);
    
    Opal.def(self, '$friday?', $Date_friday$ques$28 = function() {
      var self = this;

      return self.$wday()['$=='](5)
    }, $Date_friday$ques$28.$$arity = 0);
    
    Opal.def(self, '$jd', $Date_jd$29 = function $$jd() {
      var self = this;

      
    //Adapted from http://www.physics.sfasu.edu/astro/javascript/julianday.html

    var mm = self.date.getMonth() + 1,
        dd = self.date.getDate(),
        yy = self.date.getFullYear(),
        hr = 12, mn = 0, sc = 0,
        ggg, s, a, j1, jd;

    hr = hr + (mn / 60) + (sc/3600);

    ggg = 1;
    if (yy <= 1585) {
      ggg = 0;
    }

    jd = -1 * Math.floor(7 * (Math.floor((mm + 9) / 12) + yy) / 4);

    s = 1;
    if ((mm - 9) < 0) {
      s =- 1;
    }

    a = Math.abs(mm - 9);
    j1 = Math.floor(yy + s * Math.floor(a / 7));
    j1 = -1 * Math.floor((Math.floor(j1 / 100) + 1) * 3 / 4);

    jd = jd + Math.floor(275 * mm / 9) + dd + (ggg * j1);
    jd = jd + 1721027 + 2 * ggg + 367 * yy - 0.5;
    jd = jd + (hr / 24);

    return jd;
    
    }, $Date_jd$29.$$arity = 0);
    
    Opal.def(self, '$julian?', $Date_julian$ques$30 = function() {
      var self = this;

      return self.date < new Date(1582, 10 - 1, 15, 12)
    }, $Date_julian$ques$30.$$arity = 0);
    
    Opal.def(self, '$monday?', $Date_monday$ques$31 = function() {
      var self = this;

      return self.$wday()['$=='](1)
    }, $Date_monday$ques$31.$$arity = 0);
    
    Opal.def(self, '$month', $Date_month$32 = function $$month() {
      var self = this;

      return self.date.getMonth() + 1
    }, $Date_month$32.$$arity = 0);
    
    Opal.def(self, '$next', $Date_next$33 = function $$next() {
      var self = this;

      return $rb_plus(self, 1)
    }, $Date_next$33.$$arity = 0);
    
    Opal.def(self, '$next_day', $Date_next_day$34 = function $$next_day(n) {
      var self = this;

      
      
      if (n == null) {
        n = 1;
      };
      return $rb_plus(self, n);
    }, $Date_next_day$34.$$arity = -1);
    
    Opal.def(self, '$next_month', $Date_next_month$35 = function $$next_month(n) {
      var self = this;

      
      
      if (n == null) {
        n = 1;
      };
      
      var result = self.$clone(), date = result.date, cur = date.getDate();
      date.setDate(1);
      date.setMonth(date.getMonth() + n);
      date.setDate(Math.min(cur, days_in_month(date.getFullYear(), date.getMonth())));
      return result;
    ;
    }, $Date_next_month$35.$$arity = -1);
    
    Opal.def(self, '$next_year', $Date_next_year$36 = function $$next_year(years) {
      var self = this;

      
      
      if (years == null) {
        years = 1;
      };
      return self.$class().$new($rb_plus(self.$year(), years), self.$month(), self.$day());
    }, $Date_next_year$36.$$arity = -1);
    
    Opal.def(self, '$prev_day', $Date_prev_day$37 = function $$prev_day(n) {
      var self = this;

      
      
      if (n == null) {
        n = 1;
      };
      return $rb_minus(self, n);
    }, $Date_prev_day$37.$$arity = -1);
    
    Opal.def(self, '$prev_month', $Date_prev_month$38 = function $$prev_month(n) {
      var self = this;

      
      
      if (n == null) {
        n = 1;
      };
      
      var result = self.$clone(), date = result.date, cur = date.getDate();
      date.setDate(1);
      date.setMonth(date.getMonth() - n);
      date.setDate(Math.min(cur, days_in_month(date.getFullYear(), date.getMonth())));
      return result;
    ;
    }, $Date_prev_month$38.$$arity = -1);
    
    Opal.def(self, '$prev_year', $Date_prev_year$39 = function $$prev_year(years) {
      var self = this;

      
      
      if (years == null) {
        years = 1;
      };
      return self.$class().$new($rb_minus(self.$year(), years), self.$month(), self.$day());
    }, $Date_prev_year$39.$$arity = -1);
    
    Opal.def(self, '$saturday?', $Date_saturday$ques$40 = function() {
      var self = this;

      return self.$wday()['$=='](6)
    }, $Date_saturday$ques$40.$$arity = 0);
    
    Opal.def(self, '$strftime', $Date_strftime$41 = function $$strftime(format) {
      var self = this;

      
      
      if (format == null) {
        format = "";
      };
      
      if (format == '') {
        return self.$to_s();
      }

      return self.date.$strftime(format);
    ;
    }, $Date_strftime$41.$$arity = -1);
    $alias(self, "succ", "next");
    
    Opal.def(self, '$sunday?', $Date_sunday$ques$42 = function() {
      var self = this;

      return self.$wday()['$=='](0)
    }, $Date_sunday$ques$42.$$arity = 0);
    
    Opal.def(self, '$thursday?', $Date_thursday$ques$43 = function() {
      var self = this;

      return self.$wday()['$=='](4)
    }, $Date_thursday$ques$43.$$arity = 0);
    
    Opal.def(self, '$to_s', $Date_to_s$44 = function $$to_s() {
      var self = this;

      
      var d = self.date, year = d.getFullYear(), month = d.getMonth() + 1, day = d.getDate();
      if (month < 10) { month = '0' + month; }
      if (day < 10) { day = '0' + day; }
      return year + '-' + month + '-' + day;
    
    }, $Date_to_s$44.$$arity = 0);
    
    Opal.def(self, '$to_time', $Date_to_time$45 = function $$to_time() {
      var self = this;

      return $$($nesting, 'Time').$new(self.$year(), self.$month(), self.$day())
    }, $Date_to_time$45.$$arity = 0);
    
    Opal.def(self, '$to_n', $Date_to_n$46 = function $$to_n() {
      var self = this;

      return self.date
    }, $Date_to_n$46.$$arity = 0);
    
    Opal.def(self, '$tuesday?', $Date_tuesday$ques$47 = function() {
      var self = this;

      return self.$wday()['$=='](2)
    }, $Date_tuesday$ques$47.$$arity = 0);
    
    Opal.def(self, '$step', $Date_step$48 = function $$step(limit, step) {
      var $iter = $Date_step$48.$$p, block = $iter || nil, $$49, $$50, self = this, steps_count = nil, steps = nil, result = nil;

      if ($iter) $Date_step$48.$$p = null;
      
      
      if ($iter) $Date_step$48.$$p = null;;
      
      if (step == null) {
        step = 1;
      };
      steps_count = $rb_minus(limit, self).$to_i();
      steps = (function() {if ($truthy($rb_lt($rb_times(steps_count, step), 0))) {
        return []
      } else if ($truthy($rb_lt(steps_count, 0))) {
        return $send(Opal.Range.$new(0, steps_count['$-@'](), false).$step(step.$abs()), 'map', [], "-@".$to_proc()).$reverse()
      } else {
        return Opal.Range.$new(0, steps_count, false).$step(step.$abs())
      }; return nil; })();
      result = $send(steps, 'map', [], ($$49 = function(i){var self = $$49.$$s == null ? this : $$49.$$s;

        
        
        if (i == null) {
          i = nil;
        };
        return $rb_plus(self, i);}, $$49.$$s = self, $$49.$$arity = 1, $$49));
      if ((block !== nil)) {
        
        $send(result, 'each', [], ($$50 = function(i){var self = $$50.$$s == null ? this : $$50.$$s;

          
          
          if (i == null) {
            i = nil;
          };
          return Opal.yield1(block, i);;}, $$50.$$s = self, $$50.$$arity = 1, $$50));
        return self;
      } else {
        return result
      };
    }, $Date_step$48.$$arity = -2);
    
    Opal.def(self, '$upto', $Date_upto$51 = function $$upto(max) {
      var $iter = $Date_upto$51.$$p, block = $iter || nil, self = this;

      if ($iter) $Date_upto$51.$$p = null;
      
      
      if ($iter) $Date_upto$51.$$p = null;;
      return $send(self, 'step', [max, 1], block.$to_proc());
    }, $Date_upto$51.$$arity = 1);
    
    Opal.def(self, '$downto', $Date_downto$52 = function $$downto(min) {
      var $iter = $Date_downto$52.$$p, block = $iter || nil, self = this;

      if ($iter) $Date_downto$52.$$p = null;
      
      
      if ($iter) $Date_downto$52.$$p = null;;
      return $send(self, 'step', [min, -1], block.$to_proc());
    }, $Date_downto$52.$$arity = 1);
    
    Opal.def(self, '$wday', $Date_wday$53 = function $$wday() {
      var self = this;

      return self.date.getDay()
    }, $Date_wday$53.$$arity = 0);
    
    Opal.def(self, '$wednesday?', $Date_wednesday$ques$54 = function() {
      var self = this;

      return self.$wday()['$=='](3)
    }, $Date_wednesday$ques$54.$$arity = 0);
    
    Opal.def(self, '$year', $Date_year$55 = function $$year() {
      var self = this;

      return self.date.getFullYear()
    }, $Date_year$55.$$arity = 0);
    
    Opal.def(self, '$cwday', $Date_cwday$56 = function $$cwday() {
      var self = this;

      return self.date.getDay() || 7
    }, $Date_cwday$56.$$arity = 0);
    
    Opal.def(self, '$cweek', $Date_cweek$57 = function $$cweek() {
      var self = this;

      
      var d = new Date(self.date);
      d.setHours(0,0,0);
      d.setDate(d.getDate()+4-(d.getDay()||7));
      return Math.ceil((((d-new Date(d.getFullYear(),0,1))/8.64e7)+1)/7);
    
    }, $Date_cweek$57.$$arity = 0);
    
    function days_in_month(year, month) {
      var leap = ((year % 4 === 0 && year % 100 !== 0) || year % 400 === 0);
      return [31, (leap ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month]
    }
  ;
  })($nesting[0], null, $nesting)
};
