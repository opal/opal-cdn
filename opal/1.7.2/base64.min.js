Opal.modules.base64=function(Opal){var $module=Opal.module,$defs=Opal.defs,$ensure_kwargs=Opal.ensure_kwargs,$truthy=Opal.truthy,$nesting=[],nil=Opal.nil;return Opal.add_stubs("raise,delete"),function($base,$parent_nesting){var encode,decode,self=$module($base,"Base64"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return encode=function(input){for(var block,charCode,str=String(input),idx=0,map=chars,output="";str.charAt(0|idx)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8))(charCode=str.charCodeAt(idx+=3/4))>255&&self.$raise($$("ArgumentError"),"invalid character (failed: The string to be encoded contains characters outside of the Latin1 range.)"),block=block<<8|charCode;return output},decode=function(input){var str=String(input).replace(/=+$/,"");str.length%4==1&&self.$raise($$("ArgumentError"),"invalid base64 (failed: The string to be decoded is not correctly encoded.)");for(var bs,buffer,bc=0,idx=0,output="";buffer=str.charAt(idx++);~buffer&&(bs=bc%4?64*bs+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0)buffer=chars.indexOf(buffer);return output},$defs(self,"$decode64",(function(string){return decode(string.replace(/\r?\n/g,""))})),$defs(self,"$encode64",(function(string){return encode(string).replace(/(.{60})/g,"$1\n").replace(/([^\n])$/g,"$1\n")})),$defs(self,"$strict_decode64",(function(string){return decode(string)})),$defs(self,"$strict_encode64",(function(string){return encode(string)})),$defs(self,"$urlsafe_decode64",(function(string){return decode(string.replace(/\-/g,"+").replace(/_/g,"/"))})),$defs(self,"$urlsafe_encode64",(function(string,$kwargs){var padding,str=nil;return null==(padding=($kwargs=$ensure_kwargs($kwargs)).$$smap.padding)&&(padding=!0),str=encode(string).replace(/\+/g,"-").replace(/\//g,"_"),$truthy(padding)||(str=str.$delete("=")),str}),-2)}($nesting[0],$nesting)};
