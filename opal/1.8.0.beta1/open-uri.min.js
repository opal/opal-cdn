Opal.modules.stringio=function(Opal){var $klass=Opal.klass,$const_set=Opal.const_set,$defs=Opal.defs,$send2=Opal.send2,$find_super=Opal.find_super,$def=Opal.def,$eqeqeq=Opal.eqeqeq,$truthy=Opal.truthy,$rb_ge=Opal.rb_ge,$rb_gt=Opal.rb_gt,$rb_plus=Opal.rb_plus,$rb_minus=Opal.rb_minus,$return_ivar=Opal.return_ivar,$eqeq=Opal.eqeq,$alias=Opal.alias,$nesting=[],$$=Opal.$r($nesting),nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("new,call,close,attr_accessor,check_readable,==,length,===,>=,raise,>,+,-,seek,check_writable,String,[],eof?,write,read,tell"),function($base,$super,$parent_nesting){var self=$klass($base,$super,"StringIO"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),$proto=self.$$prototype;return $proto.position=$proto.string=nil,$const_set($nesting[0],"VERSION","0"),$defs(self,"$open",(function $$open(string,mode){var res,block=$$open.$$p||nil,io=nil;return $$open.$$p=null,null==string&&(string=""),null==mode&&(mode=nil),io=this.$new(string,mode),res=block.$call(io),io.$close(),res}),-1),self.$attr_accessor("string"),$def(self,"$initialize",(function $$initialize(string,mode){return $$initialize.$$p=null,null==string&&(string=""),null==mode&&(mode="rw"),this.string=string,this.position=0,$send2(this,$find_super(this,"initialize",$$initialize,!1,!0),"initialize",[nil,mode],null)}),-1),$def(self,"$eof?",(function(){return this.$check_readable(),this.position["$=="](this.string.$length())})),$def(self,"$seek",(function(pos,whence){var $ret_or_1;return null==whence&&(whence=$$$($$("IO"),"SEEK_SET")),this.read_buffer="",$eqeqeq($$$($$("IO"),"SEEK_SET"),$ret_or_1=whence)?($truthy($rb_ge(pos,0))||this.$raise($$$($$("Errno"),"EINVAL")),this.position=pos):$eqeqeq($$$($$("IO"),"SEEK_CUR"),$ret_or_1)?$truthy($rb_gt($rb_plus(this.position,pos),this.string.$length()))?this.position=this.string.$length():this.position=$rb_plus(this.position,pos):$eqeqeq($$$($$("IO"),"SEEK_END"),$ret_or_1)&&($truthy($rb_gt(pos,this.string.$length()))?this.position=0:this.position=$rb_minus(this.position,pos)),0}),-2),$def(self,"$tell",$return_ivar("position")),$def(self,"$rewind",(function(){return this.$seek(0)})),$def(self,"$write",(function(string){var before=nil,after=nil;return this.$check_writable(),this.read_buffer="",string=this.$String(string),$eqeq(this.string.$length(),this.position)?(this.string=$rb_plus(this.string,string),this.position=$rb_plus(this.position,string.$length())):(before=this.string["$[]"](Opal.Range.$new(0,$rb_minus(this.position,1),!1)),after=this.string["$[]"](Opal.Range.$new($rb_plus(this.position,string.$length()),-1,!1)),this.string=$rb_plus($rb_plus(before,string),after),this.position=$rb_plus(this.position,string.$length()))})),$def(self,"$read",(function(length,outbuf){var string,str=nil;return null==length&&(length=nil),null==outbuf&&(outbuf=nil),this.$check_readable(),$truthy(this["$eof?"]())?nil:(string=$truthy(length)?(str=this.string["$[]"](this.position,length),this.position=$rb_plus(this.position,length),$truthy($rb_gt(this.position,this.string.$length()))&&(this.position=this.string.$length()),str):(str=this.string["$[]"](Opal.Range.$new(this.position,-1,!1)),this.position=this.string.$length(),str),$truthy(outbuf)?outbuf.$write(string):string)}),-1),$def(self,"$sysread",(function(length){return this.$check_readable(),this.$read(length)})),$alias(self,"eof","eof?"),$alias(self,"pos","tell"),$alias(self,"pos=","seek"),$alias(self,"readpartial","read")}($nesting[0],$$("IO"),$nesting)},Opal.modules["corelib/pack_unpack/format_string_parser"]=function(Opal){var self,directives,modifiers,$module=Opal.module,$Kernel=Opal.Kernel,$$$=(Opal.nil,Opal.$$$);return Opal.add_stubs("raise"),self=$module("::","PackUnpack"),directives=["C","S","L","Q","J","c","s","l","q","j","n","N","v","V","U","w","D","d","F","f","E","e","G","g","A","a","Z","B","b","H","h","u","M","m","P","p","@","X","x"],modifiers=["!","_",">","<"],void(self.eachDirectiveAndCount=function(format,callback){var currentDirective,currentCount,currentModifiers,countSpecified;function reset(){currentDirective=null,currentCount=0,currentModifiers=[],countSpecified=!1}function yieldAndReset(){null!=currentDirective?(!/[sSiIlLqQjJ]/.test(currentDirective)&&currentModifiers.length>0&&$Kernel.$raise($$$("ArgumentError"),"'"+currentModifiers[0]+"' allowed only after types sSiIlLqQjJ"),-1!==currentModifiers.indexOf("<")&&-1!==currentModifiers.indexOf(">")&&$Kernel.$raise($$$("RangeError"),"Can't use both '<' and '>'"),countSpecified||(currentCount=1),-1!==currentModifiers.indexOf(">")&&(currentDirective+=">"),callback(currentDirective,currentCount),reset()):reset()}reset();for(var i=0;i<format.length;i++){var currentChar=format[i];-1!==directives.indexOf(currentChar)?(yieldAndReset(),currentDirective=currentChar):currentDirective&&(/\d/.test(currentChar)?(currentCount=10*currentCount+parseInt(currentChar,10),countSpecified=!0):"*"===currentChar&&!1===countSpecified?(currentCount=1/0,countSpecified=!0):-1!==modifiers.indexOf(currentChar)&&!1===countSpecified?currentModifiers.push(currentChar):yieldAndReset())}yieldAndReset()})},Opal.modules["corelib/array/pack"]=function(Opal){var $coerce_to=Opal.coerce_to,$klass=Opal.klass,$Kernel=Opal.Kernel,$Opal=Opal.Opal,$def=Opal.def,self=Opal.top,nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("require,raise,delete,gsub,coerce_to!,inspect"),self.$require("corelib/pack_unpack/format_string_parser"),function($base,$super){var self=$klass("::",null,"Array"),eachDirectiveAndCount=Opal.PackUnpack.eachDirectiveAndCount;function identityFunction(value){return value}function asciiBytesToUtf16LEString(bytes){return String.fromCharCode.apply(null,bytes)}function asciiStringFromUnsignedInt(bytes,callback){return function(data){return callback(data).map((function(item){for(var result=[],i=0;i<bytes;i++){var bit=255&item;result.push(bit),item>>=8}return asciiBytesToUtf16LEString(result)}))}}function asciiStringFromSignedInt(bytes,callback){return function(data){var buffer=callback(data),bits=8*bytes,limit=Math.pow(2,bits);return buffer.map((function(item){item<0&&(item+=limit);for(var result=[],i=0;i<bytes;i++){var bit=255&item;result.push(bit),item>>=8}return asciiBytesToUtf16LEString(result)}))}}function toInt(callback){return function(data){return callback(data).map((function(item){return $coerce_to(item,$$$("Integer"),"to_int")}))}}function joinChars(callback){return function(data){return callback(data).join("")}}var callback,handlers={C:joinChars(asciiStringFromUnsignedInt(1,toInt(identityFunction))),S:joinChars(asciiStringFromUnsignedInt(2,toInt(identityFunction))),L:joinChars(asciiStringFromUnsignedInt(4,toInt(identityFunction))),Q:joinChars(asciiStringFromUnsignedInt(8,toInt(identityFunction))),J:null,"S>":null,"L>":null,"Q>":null,c:joinChars(asciiStringFromSignedInt(1,toInt(identityFunction))),s:joinChars(asciiStringFromSignedInt(2,toInt(identityFunction))),l:joinChars(asciiStringFromSignedInt(4,toInt(identityFunction))),q:joinChars(asciiStringFromSignedInt(8,toInt(identityFunction))),j:null,"s>":null,"l>":null,"q>":null,n:null,N:null,v:null,V:null,U:joinChars((callback=toInt(identityFunction),function(data){return callback(data).map((function(item){try{return String.fromCodePoint(item)}catch(error){throw error instanceof RangeError&&$Kernel.$raise($$$("RangeError"),"value out of range"),error}}))})),w:null,D:null,d:null,F:null,f:null,E:null,e:null,G:null,g:null,A:joinChars(identityFunction),a:joinChars(identityFunction),Z:null,B:null,b:null,H:null,h:null,u:null,M:null,m:null,P:null,p:null};function readNTimesFromBufferAndMerge(callback){return function(buffer,count){var chunkData,chunk=[];if(count===1/0)for(;buffer.length>0;)buffer=(chunkData=callback(buffer)).rest,chunk=chunk.concat(chunkData.chunk);else{buffer.length<count&&$Kernel.$raise($$$("ArgumentError"),"too few arguments");for(var i=0;i<count;i++)buffer=(chunkData=callback(buffer)).rest,chunk=chunk.concat(chunkData.chunk)}return{chunk:chunk,rest:buffer}}}function readItem(buffer){return{chunk:buffer.slice(0,1),rest:buffer=buffer.slice(1,buffer.length)}}function readNCharsFromTheFirstItemAndMergeWithFallback(fallback,callback){return function(buffer,count){var chunk=[],source=buffer[0];function infiniteReeder(){var chunkData=callback(source);source=chunkData.rest;var subChunk=chunkData.chunk;1===subChunk.length&&subChunk[0]===nil&&(subChunk=[]),chunk=chunk.concat(subChunk)}function finiteReeder(){var chunkData=callback(source);source=chunkData.rest;var subChunk=chunkData.chunk;0===subChunk.length&&(subChunk=[fallback]),1===subChunk.length&&subChunk[0]===nil&&(subChunk=[fallback]),chunk=chunk.concat(subChunk)}if(source===nil?source="":void 0===source?$Kernel.$raise($$$("ArgumentError"),"too few arguments"):source=$coerce_to(source,$$$("String"),"to_str"),buffer=buffer.slice(1,buffer.length),count===1/0)for(;source.length>0;)infiniteReeder();else for(var i=0;i<count;i++)finiteReeder();return{chunk:chunk,rest:buffer}}}var readChunk={C:readNTimesFromBufferAndMerge(readItem),S:readNTimesFromBufferAndMerge(readItem),L:readNTimesFromBufferAndMerge(readItem),Q:readNTimesFromBufferAndMerge(readItem),J:null,"S>":null,"L>":null,"Q>":null,c:readNTimesFromBufferAndMerge(readItem),s:readNTimesFromBufferAndMerge(readItem),l:readNTimesFromBufferAndMerge(readItem),q:readNTimesFromBufferAndMerge(readItem),j:null,"s>":null,"l>":null,"q>":null,n:null,N:null,v:null,V:null,U:readNTimesFromBufferAndMerge(readItem),w:null,D:null,d:null,F:null,f:null,E:null,e:null,G:null,g:null,A:readNCharsFromTheFirstItemAndMergeWithFallback(" ",readItem),a:readNCharsFromTheFirstItemAndMergeWithFallback("\0",readItem),Z:null,B:null,b:null,H:null,h:null,u:null,M:null,m:null,P:null,p:null},autocompletion={C:!1,S:!1,L:!1,Q:!1,J:null,"S>":null,"L>":null,"Q>":null,c:!1,s:!1,l:!1,q:!1,j:null,"s>":null,"l>":null,"q>":null,n:null,N:null,v:null,V:null,U:!1,w:null,D:null,d:null,F:null,f:null,E:null,e:null,G:null,g:null,A:!1,a:!1,Z:null,B:null,b:null,H:null,h:null,u:!1,M:null,m:null,P:null,p:null};return $def(self,"$pack",(function(format){format=$Opal["$coerce_to!"](format,$$$("String"),"to_str").$gsub(/\s/,"").$delete("\0");var output="",buffer=this.slice();return eachDirectiveAndCount(format,(function(directive,count){var part=function(directive,count){var chunk,chunkReader=readChunk[directive];null==chunkReader&&$Kernel.$raise("Unsupported pack directive "+directive.$inspect()+" (no chunk reader defined)");var chunkData=chunkReader(buffer,count);chunk=chunkData.chunk,buffer=chunkData.rest;var handler=handlers[directive];return null==handler&&$Kernel.$raise("Unsupported pack directive "+directive.$inspect()+" (no handler defined)"),handler(chunk)}(directive,count);if(count!==1/0){var shouldAutocomplete=autocompletion[directive];null==shouldAutocomplete&&$Kernel.$raise("Unsupported pack directive "+directive.$inspect()+" (no autocompletion rule defined)"),shouldAutocomplete&&function(array,size){for(;array.length<size;)array.push(nil)}(part,count)}output=output.concat(part)})),format.match(/^(U\*?)+$/)?output:Opal.enc(output,"binary")}))}()},Opal.modules["open-uri"]=function(Opal){var $module=Opal.module,$alias=Opal.alias,$slice=Opal.slice,$truthy=Opal.truthy,$send=Opal.send,$to_a=Opal.to_a,$def=Opal.def,$defs=Opal.defs,$eqeq=Opal.eqeq,$klass=Opal.klass,$send2=Opal.send2,$find_super=Opal.find_super,$rb_plus=Opal.rb_plus,$eqeqeq=Opal.eqeqeq,self=Opal.top,$nesting=[],nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("require,private,open,=~,respond_to?,open_uri,to_proc,open_uri_original_open,module_function,open_loop,rewind,close_io,close!,closed?,close,request,==,build_response,raise,new,<<,pack,data,io,status=,meta_add_field,attr_reader,+,length,===,init,extend,instance_eval,status,base_uri=,base_uri,each,metas,meta_add_field2,attr_accessor,charset,find_encoding,set_encoding,force_encoding,string,find,downcase,[]=,join,meta_setup_encoding,[],utc,at,content_type_parse,scheme,read"),self.$require("stringio"),self.$require("corelib/array/pack"),function($base,$parent_nesting){var self=$module($base,"Kernel"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);self.$private(),$alias(self,"open_uri_original_open","open"),function(self,$parent_nesting){$alias(self,"open_uri_original_open","open")}(Opal.get_singleton_class(self)),$def(self,"$open",(function $$open(name,$a){var rest,block=$$open.$$p||nil,self=this;return $$open.$$p=null,rest=$slice(arguments,1),$truthy(name["$respond_to?"]("to_str"))&&$truthy(/^[A-Za-z][A-Za-z0-9+\-\.]*:\/\//["$=~"](name))?$send($$("OpenURI"),"open_uri",[name].concat($to_a(rest)),block.$to_proc()):$send(self,"open_uri_original_open",[name].concat($to_a(rest)),block.$to_proc())}),-2),self.$module_function("open")}($nesting[0],$nesting),function($base,$parent_nesting){var self=$module($base,"OpenURI"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);return $defs(self,"$open_uri",(function $$open_uri(name,$a){var $yield=$$open_uri.$$p||nil,self=this,io=nil;return $$open_uri.$$p=null,$slice(arguments,1),(io=self.$open_loop(name,new Map)).$rewind(),$yield!==nil?function(){try{return Opal.yield1($yield,io)}finally{self.$close_io(io)}}():io}),-2),$defs(self,"$close_io",(function(io){return $truthy(io["$respond_to?"]("close!"))?io["$close!"]():$truthy(io["$closed?"]())?nil:io.$close()})),$defs(self,"$open_loop",(function(uri,options){var req,data,status,status_text;return data=(req=this.$request(uri)).responseText,status=req.status,status_text=req.statusText&&req.statusText.errno?req.statusText.errno:req.statusText,$eqeq(status,200)||$eqeq(status,0)&&$truthy(data)?this.$build_response(req,status,status_text):this.$raise($$$($$("OpenURI"),"HTTPError").$new(status+" "+status_text,""))})),$defs(self,"$build_response",(function(req,status,status_text){var last_modified,buf=nil,io=nil;return(buf=$$("Buffer").$new())["$<<"](this.$data(req).$pack("c*")),(io=buf.$io())["$status="](status+" "+status_text),io.$meta_add_field("content-type",req.getResponseHeader("Content-Type")||""),last_modified=req.getResponseHeader("Last-Modified"),$truthy(last_modified)&&io.$meta_add_field("last-modified",last_modified),io})),$defs(self,"$data",(function(req){for(var binStr=req.responseText,byteArray=[],i=0,len=binStr.length;i<len;++i){var byteCode=255&binStr.charCodeAt(i);byteArray.push(byteCode)}return byteArray})),$defs(self,"$request",(function(uri){try{var xhr=new XMLHttpRequest;return xhr.open("GET",uri,!1),xhr.overrideMimeType("text/plain; charset=x-user-defined"),xhr.send(),xhr}catch(error){this.$raise($$$($$("OpenURI"),"HTTPError").$new(error.message,""))}})),function($base,$super){var self=$klass($base,$super,"HTTPError");$def(self,"$initialize",(function $$initialize(message,io){return $$initialize.$$p=null,$send2(this,$find_super(this,"initialize",$$initialize,!1,!0),"initialize",[message,io],null),this.io=io})),self.$attr_reader("io")}($nesting[0],$$("StandardError")),function($base,$super,$parent_nesting){var self=$klass($base,null,"Buffer"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),$proto=self.$$prototype;$proto.io=$proto.size=nil,$def(self,"$initialize",(function(){return this.io=$$("StringIO").$new(),this.size=0})),self.$attr_reader("size"),$def(self,"$<<",(function(str){return this.io["$<<"](str),this.size=$rb_plus(this.size,str.$length())})),$def(self,"$io",(function(){return $eqeqeq($$("Meta"),this.io)||$$("Meta").$init(this.io),this.io}))}($nesting[0],0,$nesting),function($base,$parent_nesting){var self=$module($base,"Meta"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);$defs($$("Meta"),"$init",(function(obj,src){return null==src&&(src=nil),obj.$extend($$("Meta")),$send(obj,"instance_eval",[],(function $$2(){var self=null==$$2.$$s?this:$$2.$$s;return self.base_uri=nil,self.meta=new Map,self.metas=new Map}),{$$s:this}),$truthy(src)?(obj["$status="](src.$status()),obj["$base_uri="](src.$base_uri()),$send(src.$metas(),"each",[],(function(name,values){return null==name&&(name=nil),null==values&&(values=nil),obj.$meta_add_field2(name,values)}))):nil}),-2),self.$attr_accessor("status"),self.$attr_accessor("base_uri"),self.$attr_reader("meta"),self.$attr_reader("metas"),$def(self,"$meta_setup_encoding",(function(){var charset,enc;return charset=this.$charset(),enc=this.$find_encoding(charset),this.$set_encoding(enc)})),$def(self,"$set_encoding",(function(enc){return $truthy(this["$respond_to?"]("force_encoding"))?this.$force_encoding(enc):$truthy(this["$respond_to?"]("string"))?this.$string().$force_encoding(enc):this.$set_encoding(enc)})),$def(self,"$find_encoding",(function(charset){var enc=nil;if(enc=nil,$truthy(charset))try{enc=$$("Encoding").$find(charset)}catch($err){if(!Opal.rescue($err,[$$("ArgumentError")]))throw $err;Opal.pop_exception($err)}return $truthy(enc)||(enc=$$$($$("Encoding"),"ASCII_8BIT")),enc})),$def(self,"$meta_add_field2",(function(name,values){return null==this.metas&&(this.metas=nil),null==this.meta&&(this.meta=nil),name=name.$downcase(),this.metas["$[]="](name,values),this.meta["$[]="](name,values.$join(", ")),$eqeq(name,"content-type")?this.$meta_setup_encoding():nil})),$def(self,"$meta_add_field",(function(name,value){return this.$meta_add_field2(name,[value])})),$def(self,"$last_modified",(function(){var vs=nil;return null==this.metas&&(this.metas=nil),$truthy(vs=this.metas["$[]"]("last-modified"))?$$("Time").$at(Date.parse(vs.$join(", "))/1e3).$utc():nil})),$def(self,"$content_type_parse",(function(){return null==this.metas&&(this.metas=nil),this.metas["$[]"]("content-type").$join(", ")})),$def(self,"$charset",(function(){var type;return null==this.base_uri&&(this.base_uri=nil),type=this.$content_type_parse(),$truthy(type)&&$truthy(/^text\//["$=~"](type))&&$truthy(this.base_uri)&&$truthy(/^http$/i["$=~"](this.base_uri.$scheme()))?"iso-8859-1":nil})),$def(self,"$content_type",(function(){var type,$ret_or_1;return type=this.$content_type_parse(),$truthy($ret_or_1=type)?$ret_or_1:"application/octet-stream"}))}($nesting[0],$nesting),function($base,$parent_nesting){var self=$module($base,"OpenRead"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);return $def(self,"$open",(function $$open($a){var rest,block=$$open.$$p||nil,self=this;return $$open.$$p=null,rest=$slice(arguments),$send($$("OpenURI"),"open_uri",[self].concat($to_a(rest)),block.$to_proc())}),-1),$def(self,"$read",(function(options){return null==options&&(options=new Map),$send(this,"open",[options],(function(f){var str;return null==f&&(f=nil),str=f.$read(),$$("Meta").$init(str,f),str}))}),-1)}($nesting[0],$nesting)}($nesting[0],$nesting)};
