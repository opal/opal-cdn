Opal.modules.prettyprint=function(Opal){var $klass=Opal.klass,$send=Opal.send,$rb_times=Opal.rb_times,$defs=Opal.defs,$truthy=Opal.truthy,$def=Opal.def,$rb_lt=Opal.rb_lt,$rb_plus=Opal.rb_plus,$rb_minus=Opal.rb_minus,$eqeqeq=Opal.eqeqeq,$assign_ivar_val=Opal.assign_ivar_val,$return_ivar=Opal.return_ivar,$slice=Opal.slice,$thrower=Opal.thrower,$return_val=Opal.return_val,$nesting=[],nil=Opal.nil;return Opal.add_stubs("dup,lambda,*,new,to_proc,flush,attr_reader,last,<,+,deq,empty?,breakables,shift,output,-,width,!,===,first,length,<<,add,break_outmost_groups,group,breakable,break?,call,text,group_sub,nest,depth,push,enq,pop,delete,each,clear,indent,current_group,newline,genspace,group_queue,[],downto,slice!,break,[]="),function($base,$super,$parent_nesting){var self=$klass($base,null,"PrettyPrint"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),$proto=self.$$prototype;return $proto.group_stack=$proto.maxwidth=$proto.output_width=$proto.buffer_width=$proto.group_queue=$proto.buffer=$proto.output=$proto.newline=$proto.genspace=$proto.indent=nil,$defs($$("PrettyPrint"),"$format",(function $$format(output,maxwidth,newline,genspace){var $yield=$$format.$$p||nil,q=nil;return $$format.$$p=null,null==output&&(output="".$dup()),null==maxwidth&&(maxwidth=79),null==newline&&(newline="\n"),null==genspace&&(genspace=$send(this,"lambda",[],(function(n){return null==n&&(n=nil),$rb_times(" ",n)}))),q=$send($$("PrettyPrint"),"new",[output,maxwidth,newline],genspace.$to_proc()),Opal.yield1($yield,q),q.$flush(),output}),-1),$defs($$("PrettyPrint"),"$singleline_format",(function $$singleline_format(output,maxwidth,newline,genspace){var q,$yield=$$singleline_format.$$p||nil;return $$singleline_format.$$p=null,null==output&&(output="".$dup()),null==maxwidth&&(maxwidth=nil),null==newline&&(newline=nil),null==genspace&&(genspace=nil),q=$$("SingleLine").$new(output),Opal.yield1($yield,q),output}),-1),$def(self,"$initialize",(function $$initialize(output,maxwidth,newline){var $ret_or_1,root_group,genspace=$$initialize.$$p||nil;return $$initialize.$$p=null,null==output&&(output="".$dup()),null==maxwidth&&(maxwidth=79),null==newline&&(newline="\n"),this.output=output,this.maxwidth=maxwidth,this.newline=newline,this.genspace=$truthy($ret_or_1=genspace)?$ret_or_1:$send(this,"lambda",[],(function(n){return null==n&&(n=nil),$rb_times(" ",n)})),this.output_width=0,this.buffer_width=0,this.buffer=[],root_group=$$("Group").$new(0),this.group_stack=[root_group],this.group_queue=$$("GroupQueue").$new(root_group),this.indent=0}),-1),self.$attr_reader("output"),self.$attr_reader("maxwidth"),self.$attr_reader("newline"),self.$attr_reader("genspace"),self.$attr_reader("indent"),self.$attr_reader("group_queue"),$def(self,"$current_group",(function(){return this.group_stack.$last()})),$def(self,"$break_outmost_groups",(function(){for(var group=nil,data=nil,$ret_or_1=nil,text=nil;$truthy($rb_lt(this.maxwidth,$rb_plus(this.output_width,this.buffer_width)));){if(!$truthy(group=this.group_queue.$deq()))return nil;for(;!$truthy(group.$breakables()["$empty?"]());)data=this.buffer.$shift(),this.output_width=data.$output(this.output,this.output_width),this.buffer_width=$rb_minus(this.buffer_width,data.$width());for(;$truthy($truthy($ret_or_1=this.buffer["$empty?"]()["$!"]())?$$("Text")["$==="](this.buffer.$first()):$ret_or_1);)text=this.buffer.$shift(),this.output_width=text.$output(this.output,this.output_width),this.buffer_width=$rb_minus(this.buffer_width,text.$width())}})),$def(self,"$text",(function(obj,width){var text=nil;return null==width&&(width=obj.$length()),$truthy(this.buffer["$empty?"]())?(this.output["$<<"](obj),this.output_width=$rb_plus(this.output_width,width)):(text=this.buffer.$last(),$eqeqeq($$("Text"),text)||(text=$$("Text").$new(),this.buffer["$<<"](text)),text.$add(obj,width),this.buffer_width=$rb_plus(this.buffer_width,width),this.$break_outmost_groups())}),-2),$def(self,"$fill_breakable",(function(sep,width){return null==sep&&(sep=" "),null==width&&(width=sep.$length()),$send(this,"group",[],(function $$3(){return(null==$$3.$$s?this:$$3.$$s).$breakable(sep,width)}),{$$s:this})}),-1),$def(self,"$breakable",(function(sep,width){var group=nil;return null==sep&&(sep=" "),null==width&&(width=sep.$length()),group=this.group_stack.$last(),$truthy(group["$break?"]())?(this.$flush(),this.output["$<<"](this.newline),this.output["$<<"](this.genspace.$call(this.indent)),this.output_width=this.indent,this.buffer_width=0):(this.buffer["$<<"]($$("Breakable").$new(sep,width,this)),this.buffer_width=$rb_plus(this.buffer_width,width),this.$break_outmost_groups())}),-1),$def(self,"$group",(function $$group(indent,open_obj,close_obj,open_width,close_width){var $yield=$$group.$$p||nil;return $$group.$$p=null,null==indent&&(indent=0),null==open_obj&&(open_obj=""),null==close_obj&&(close_obj=""),null==open_width&&(open_width=open_obj.$length()),null==close_width&&(close_width=close_obj.$length()),this.$text(open_obj,open_width),$send(this,"group_sub",[],(function $$4(){return $send(null==$$4.$$s?this:$$4.$$s,"nest",[indent],(function(){return Opal.yieldX($yield,[])}))}),{$$s:this}),this.$text(close_obj,close_width)}),-1),$def(self,"$group_sub",(function $$group_sub(){var $yield=$$group_sub.$$p||nil,self=this,group=nil;return $$group_sub.$$p=null,group=$$("Group").$new($rb_plus(self.group_stack.$last().$depth(),1)),self.group_stack.$push(group),self.group_queue.$enq(group),function(){try{return Opal.yieldX($yield,[])}finally{self.group_stack.$pop(),$truthy(group.$breakables()["$empty?"]())&&self.group_queue.$delete(group)}}()})),$def(self,"$nest",(function $$nest(indent){var $yield=$$nest.$$p||nil,self=this;return $$nest.$$p=null,self.indent=$rb_plus(self.indent,indent),function(){try{return Opal.yieldX($yield,[])}finally{self.indent=$rb_minus(self.indent,indent)}}()})),$def(self,"$flush",(function(){return $send(this.buffer,"each",[],(function $$6(data){var self=null==$$6.$$s?this:$$6.$$s;return null==self.output&&(self.output=nil),null==self.output_width&&(self.output_width=nil),null==data&&(data=nil),self.output_width=data.$output(self.output,self.output_width)}),{$$s:this}),this.buffer.$clear(),this.buffer_width=0})),function($base,$super){var self=$klass($base,null,"Text"),$proto=self.$$prototype;$proto.objs=$proto.width=nil,$def(self,"$initialize",(function(){return this.objs=[],this.width=0})),self.$attr_reader("width"),$def(self,"$output",(function(out,output_width){return $send(this.objs,"each",[],(function(obj){return null==obj&&(obj=nil),out["$<<"](obj)})),$rb_plus(output_width,this.width)})),$def(self,"$add",(function(obj,width){return this.objs["$<<"](obj),this.width=$rb_plus(this.width,width)}))}($nesting[0]),function($base,$super){var self=$klass($base,null,"Breakable"),$proto=self.$$prototype;$proto.group=$proto.pp=$proto.indent=$proto.obj=$proto.width=nil,$def(self,"$initialize",(function(sep,width,q){return this.obj=sep,this.width=width,this.pp=q,this.indent=q.$indent(),this.group=q.$current_group(),this.group.$breakables().$push(this)})),self.$attr_reader("obj"),self.$attr_reader("width"),self.$attr_reader("indent"),$def(self,"$output",(function(out,output_width){return this.group.$breakables().$shift(),$truthy(this.group["$break?"]())?(out["$<<"](this.pp.$newline()),out["$<<"](this.pp.$genspace().$call(this.indent)),this.indent):($truthy(this.group.$breakables()["$empty?"]())&&this.pp.$group_queue().$delete(this.group),out["$<<"](this.obj),$rb_plus(output_width,this.width))}))}($nesting[0]),function($base,$super){var self=$klass($base,null,"Group");$def(self,"$initialize",(function(depth){return this.depth=depth,this.breakables=[],this.break=!1})),self.$attr_reader("depth"),self.$attr_reader("breakables"),$def(self,"$break",$assign_ivar_val("break",!0)),$def(self,"$break?",$return_ivar("break")),$def(self,"$first?",(function(){var $a;return!$truthy(($a=this.first,null!=$a&&$a!==nil?"instance-variable":nil))&&(this.first=!1,!0)}))}($nesting[0]),function($base,$super){var self=$klass($base,null,"GroupQueue");self.$$prototype.queue=nil,$def(self,"$initialize",(function($a){var groups,self=this;return groups=$slice(arguments),self.queue=[],$send(groups,"each",[],(function $$9(g){return null==g&&(g=nil),(null==$$9.$$s?this:$$9.$$s).$enq(g)}),{$$s:self})}),-1),$def(self,"$enq",(function(group){var depth;for(depth=group.$depth();!$truthy($rb_lt(depth,this.queue.$length()));)this.queue["$<<"]([]);return this.queue["$[]"](depth)["$<<"](group)})),$def(self,"$deq",(function(){try{var $t_return=$thrower("return");return $send(this.queue,"each",[],(function(gs){return null==gs&&(gs=nil),$send($rb_minus(gs.$length(),1),"downto",[0],(function $$11(i){var group=nil;if(null==i&&(i=nil),$truthy(gs["$[]"](i).$breakables()["$empty?"]()))return nil;(group=gs["$slice!"](i,1).$first()).$break(),$t_return.$throw(group,$$11.$$is_lambda)}),{$$ret:$t_return}),$send(gs,"each",[],(function(group){return null==group&&(group=nil),group.$break()})),gs.$clear()})),nil}catch($e){if($e===$t_return)return $e.$v;throw $e}finally{$t_return.is_orphan=!0}})),$def(self,"$delete",(function(group){return this.queue["$[]"](group.$depth()).$delete(group)}))}($nesting[0]),function($base,$super){var self=$klass($base,null,"SingleLine"),$proto=self.$$prototype;return $proto.output=$proto.first=nil,$def(self,"$initialize",(function(output,maxwidth,newline){return null==maxwidth&&(maxwidth=nil),null==newline&&(newline=nil),this.output=output,this.first=[!0]}),-2),$def(self,"$text",(function(obj,width){return null==width&&(width=nil),this.output["$<<"](obj)}),-2),$def(self,"$breakable",(function(sep,width){return null==sep&&(sep=" "),null==width&&(width=nil),this.output["$<<"](sep)}),-1),$def(self,"$nest",(function $$nest(indent){var $yield=$$nest.$$p||nil;return $$nest.$$p=null,Opal.yieldX($yield,[])})),$def(self,"$group",(function $$group(indent,open_obj,close_obj,open_width,close_width){var $yield=$$group.$$p||nil;return $$group.$$p=null,null==indent&&(indent=nil),null==open_obj&&(open_obj=""),null==close_obj&&(close_obj=""),null==open_width&&(open_width=nil),null==close_width&&(close_width=nil),this.first.$push(!0),this.output["$<<"](open_obj),Opal.yieldX($yield,[]),this.output["$<<"](close_obj),this.first.$pop()}),-1),$def(self,"$flush",$return_val(nil)),$def(self,"$first?",(function(){var result;return result=this.first["$[]"](-1),this.first["$[]="](-1,!1),result}))}($nesting[0])}($nesting[0],0,$nesting)};
