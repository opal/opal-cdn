Opal.modules.benchmark=function(Opal){function $rb_minus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs-rhs:lhs["$-"](rhs)}function $rb_plus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs+rhs:lhs["$+"](rhs)}function $rb_times(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs*rhs:lhs["$*"](rhs)}Opal.top;var $nesting=[],nil=Opal.nil,$$$=Opal.const_get_qualified,$$=Opal.const_get_relative,$module=(Opal.breaker,Opal.slice,Opal.module),$send=Opal.send,$truthy=Opal.truthy,$klass=Opal.klass,$gvars=Opal.gvars;return Opal.add_stubs(["$sync","$sync=","$-","$+","$empty?","$print","$*","$new","$===","$each","$grep","$ljust","$shift","$label","$format","$list","$nil?","$benchmark","$to_proc","$width","$puts","$length","$inject","$measure","$rjust","$map","$start","$tap","$times","$clock_gettime","$utime","$stime","$cutime","$cstime","$module_function","$raise","$to_s","$<","$<<","$attr_reader","$real","$memberwise","$gsub","$dup","$%","$total","$protected","$__send__"]),function($base,$parent_nesting){function $Benchmark(){}var TMP_Benchmark_benchmark_1,TMP_Benchmark_bm_3,TMP_Benchmark_bmbm_4,$b,TMP_Benchmark_measure_8,TMP_Benchmark_realtime_9,self=$Benchmark=$module($base,"Benchmark",$Benchmark),$nesting=(self.prototype,[self].concat($parent_nesting));Opal.const_set($nesting[0],"BENCHMARK_VERSION","2002-04-25"),Opal.def(self,"$benchmark",TMP_Benchmark_benchmark_1=function($a,$b,$c,$d){var $post_args,caption,label_width,format,labels,$e,TMP_2,$iter=TMP_Benchmark_benchmark_1.$$p,$yield=$iter||nil,self=this,sync=nil,$writer=nil,report=nil,results=nil;return $iter&&(TMP_Benchmark_benchmark_1.$$p=null),0<($post_args=Opal.slice.call(arguments,0,arguments.length)).length&&(caption=$post_args[0],$post_args.splice(0,1)),null==caption&&(caption=""),0<$post_args.length&&(label_width=$post_args[0],$post_args.splice(0,1)),null==label_width&&(label_width=nil),0<$post_args.length&&(format=$post_args[0],$post_args.splice(0,1)),null==format&&(format=nil),labels=$post_args,function(){try{return sync=$$($nesting,"STDOUT").$sync(),$writer=[!0],$send($$($nesting,"STDOUT"),"sync=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)],label_width=$rb_plus(label_width=$truthy($e=label_width)?$e:0,1),format=$truthy($e=format)?$e:$$($nesting,"FORMAT"),$truthy(caption["$empty?"]())||self.$print($rb_plus($rb_times(" ",label_width),caption)),report=$$($nesting,"Report").$new(label_width,format),results=Opal.yield1($yield,report),$truthy($e=$$($nesting,"Array")["$==="](results))&&$send(results.$grep($$($nesting,"Tms")),"each",[],((TMP_2=function(t){var $f,$g,self=TMP_2.$$s||this;return null==t&&(t=nil),self.$print(($truthy($f=$truthy($g=labels.$shift())?$g:t.$label())?$f:"").$ljust(label_width),t.$format(format))}).$$s=self,TMP_2.$$arity=1,TMP_2)),report.$list()}finally{$truthy(sync["$nil?"]())||($writer=[sync],$send($$($nesting,"STDOUT"),"sync=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)])}}()},TMP_Benchmark_benchmark_1.$$arity=-1),Opal.def(self,"$bm",TMP_Benchmark_bm_3=function($a,$b){var $post_args,label_width,labels,$iter=TMP_Benchmark_bm_3.$$p,blk=$iter||nil;return $iter&&(TMP_Benchmark_bm_3.$$p=null),$iter&&(TMP_Benchmark_bm_3.$$p=null),0<($post_args=Opal.slice.call(arguments,0,arguments.length)).length&&(label_width=$post_args[0],$post_args.splice(0,1)),null==label_width&&(label_width=0),labels=$post_args,$send(this,"benchmark",[$$($nesting,"CAPTION"),label_width,$$($nesting,"FORMAT")].concat(Opal.to_a(labels)),blk.$to_proc())},TMP_Benchmark_bm_3.$$arity=-1),Opal.def(self,"$bmbm",TMP_Benchmark_bmbm_4=function(width){var TMP_5,TMP_6,$iter=TMP_Benchmark_bmbm_4.$$p,$yield=$iter||nil,self=this,job=nil,sync=nil,$writer=nil,ets=nil;return $iter&&(TMP_Benchmark_bmbm_4.$$p=null),null==width&&(width=0),function(){try{return job=$$($nesting,"Job").$new(width),Opal.yield1($yield,job),width=$rb_plus(job.$width(),1),sync=$$($nesting,"STDOUT").$sync(),$writer=[!0],$send($$($nesting,"STDOUT"),"sync=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)],self.$puts("Rehearsal ".$ljust($rb_plus(width,$$($nesting,"CAPTION").$length()),"-")),ets=$send(job.$list(),"inject",[$$($nesting,"Tms").$new()],(TMP_5=function(sum,$mlhs_tmp1){var $a,$b,self=TMP_5.$$s||this,label=nil,item=nil,res=nil;return null==sum&&(sum=nil),null==$mlhs_tmp1&&($mlhs_tmp1=nil),$b=$mlhs_tmp1,label=null==($a=Opal.to_ary($b))[0]?nil:$a[0],item=null==$a[1]?nil:$a[1],self.$print(label.$ljust(width)),res=$send($$($nesting,"Benchmark"),"measure",[],item.$to_proc()),self.$print(res.$format()),$rb_plus(sum,res)},TMP_5.$$s=self,TMP_5.$$arity=2,TMP_5.$$has_top_level_mlhs_arg=!0,TMP_5)).$format("total: %tsec"),self.$print((" "+ets+"\n\n").$rjust($rb_plus($rb_plus(width,$$($nesting,"CAPTION").$length()),2),"-")),self.$print($rb_plus($rb_times(" ",width),$$($nesting,"CAPTION"))),$send(job.$list(),"map",[],((TMP_6=function(label,item){var TMP_7,self=TMP_6.$$s||this;return null==label&&(label=nil),null==item&&(item=nil),$$($nesting,"GC").$start(),self.$print(label.$ljust(width)),$send($send($$($nesting,"Benchmark"),"measure",[label],item.$to_proc()),"tap",[],((TMP_7=function(res){var self=TMP_7.$$s||this;return null==res&&(res=nil),self.$print(res)}).$$s=self,TMP_7.$$arity=1,TMP_7))}).$$s=self,TMP_6.$$arity=2,TMP_6))}finally{$truthy(sync["$nil?"]())||($writer=[sync],$send($$($nesting,"STDOUT"),"sync=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)])}}()},TMP_Benchmark_bmbm_4.$$arity=-1),$truthy(($b=$$($nesting,"Process","skip_raise"))&&$$$($b,"CLOCK_MONOTONIC","skip_raise")?"constant":nil)?Opal.const_set($nesting[0],"BENCHMARK_CLOCK",$$$($$($nesting,"Process"),"CLOCK_MONOTONIC")):Opal.const_set($nesting[0],"BENCHMARK_CLOCK",$$$($$($nesting,"Process"),"CLOCK_REALTIME")),Opal.def(self,"$measure",TMP_Benchmark_measure_8=function(label){var $a,r0,r1,$iter=TMP_Benchmark_measure_8.$$p,$yield=$iter||nil,t0=nil,t1=nil;return $iter&&(TMP_Benchmark_measure_8.$$p=null),null==label&&(label=""),t0=($a=[$$($nesting,"Process").$times(),$$($nesting,"Process").$clock_gettime($$($nesting,"BENCHMARK_CLOCK"))])[0],r0=$a[1],Opal.yieldX($yield,[]),t1=($a=[$$($nesting,"Process").$times(),$$($nesting,"Process").$clock_gettime($$($nesting,"BENCHMARK_CLOCK"))])[0],r1=$a[1],$$$($$($nesting,"Benchmark"),"Tms").$new($rb_minus(t1.$utime(),t0.$utime()),$rb_minus(t1.$stime(),t0.$stime()),$rb_minus(t1.$cutime(),t0.$cutime()),$rb_minus(t1.$cstime(),t0.$cstime()),$rb_minus(r1,r0),label)},TMP_Benchmark_measure_8.$$arity=-1),Opal.def(self,"$realtime",TMP_Benchmark_realtime_9=function(){var r0,$iter=TMP_Benchmark_realtime_9.$$p,$yield=$iter||nil;return $iter&&(TMP_Benchmark_realtime_9.$$p=null),r0=$$($nesting,"Process").$clock_gettime($$($nesting,"BENCHMARK_CLOCK")),Opal.yieldX($yield,[]),$rb_minus($$($nesting,"Process").$clock_gettime($$($nesting,"BENCHMARK_CLOCK")),r0)},TMP_Benchmark_realtime_9.$$arity=0),self.$module_function("benchmark","measure","realtime","bm","bmbm"),function($base,$super,$parent_nesting){function $Job(){}var TMP_Job_initialize_10,TMP_Job_item_11,self=$Job=$klass($base,null,"Job",$Job),def=self.prototype,$nesting=[self].concat($parent_nesting);def.width=def.list=nil,Opal.def(self,"$initialize",TMP_Job_initialize_10=function(width){return this.width=width,this.list=[]},TMP_Job_initialize_10.$$arity=1),Opal.def(self,"$item",TMP_Job_item_11=function(label){var w,lhs,rhs,$iter=TMP_Job_item_11.$$p,blk=$iter||nil;return $iter&&(TMP_Job_item_11.$$p=null),$iter&&(TMP_Job_item_11.$$p=null),null==label&&(label=""),blk!==nil||this.$raise($$($nesting,"ArgumentError"),"no block"),w=(label=label.$to_s()).$length(),$truthy((lhs=this.width,rhs=w,"number"==typeof lhs&&"number"==typeof rhs?lhs<rhs:lhs["$<"](rhs)))&&(this.width=w),this.list["$<<"]([label,blk]),this},TMP_Job_item_11.$$arity=-1),Opal.alias(self,"report","item"),self.$attr_reader("list"),self.$attr_reader("width")}($nesting[0],0,$nesting),function($base,$super,$parent_nesting){function $Report(){}var TMP_Report_initialize_12,TMP_Report_item_13,self=$Report=$klass($base,null,"Report",$Report),def=self.prototype,$nesting=[self].concat($parent_nesting);def.width=def.list=def.format=nil,Opal.def(self,"$initialize",TMP_Report_initialize_12=function(width,format){var $a;return null==width&&(width=0),null==format&&(format=nil),$a=[width,format,[]],this.width=$a[0],this.format=$a[1],this.list=$a[2],$a},TMP_Report_initialize_12.$$arity=-1),Opal.def(self,"$item",TMP_Report_item_13=function($a,$b){var $post_args,label,format,res,$iter=TMP_Report_item_13.$$p,blk=$iter||nil;return $iter&&(TMP_Report_item_13.$$p=null),$iter&&(TMP_Report_item_13.$$p=null),0<($post_args=Opal.slice.call(arguments,0,arguments.length)).length&&(label=$post_args[0],$post_args.splice(0,1)),null==label&&(label=""),format=$post_args,this.$print(label.$to_s().$ljust(this.width)),this.list["$<<"](res=$send($$($nesting,"Benchmark"),"measure",[label],blk.$to_proc())),this.$print($send(res,"format",[this.format].concat(Opal.to_a(format)))),res},TMP_Report_item_13.$$arity=-1),Opal.alias(self,"report","item"),self.$attr_reader("list")}($nesting[0],0,$nesting),function($base,$super,$parent_nesting){function $Tms(){}var TMP_Tms_initialize_14,TMP_Tms_add_15,TMP_Tms_add$B_16,TMP_Tms_$_17,TMP_Tms_$_18,TMP_Tms_$_19,TMP_Tms_$_20,TMP_Tms_format_21,TMP_Tms_to_s_29,TMP_Tms_to_a_30,TMP_Tms_memberwise_31,self=$Tms=$klass($base,null,"Tms",$Tms),def=self.prototype,$nesting=[self].concat($parent_nesting);def.utime=def.stime=def.cutime=def.cstime=def.label=def.real=nil,Opal.const_set($nesting[0],"CAPTION","      user     system      total        real\n"),Opal.const_set($nesting[0],"FORMAT","%10.6u %10.6y %10.6t %10.6r\n"),self.$attr_reader("utime"),self.$attr_reader("stime"),self.$attr_reader("cutime"),self.$attr_reader("cstime"),self.$attr_reader("real"),self.$attr_reader("total"),self.$attr_reader("label"),Opal.def(self,"$initialize",TMP_Tms_initialize_14=function(utime,stime,cutime,cstime,real,label){var $a;return null==utime&&(utime=0),null==stime&&(stime=0),null==cutime&&(cutime=0),null==cstime&&(cstime=0),null==real&&(real=0),null==label&&(label=nil),$a=[utime,stime,cutime,cstime,real,label.$to_s()],this.utime=$a[0],this.stime=$a[1],this.cutime=$a[2],this.cstime=$a[3],this.real=$a[4],this.label=$a[5],this.total=$rb_plus($rb_plus($rb_plus(this.utime,this.stime),this.cutime),this.cstime)},TMP_Tms_initialize_14.$$arity=-1),Opal.def(self,"$add",TMP_Tms_add_15=function(){var $iter=TMP_Tms_add_15.$$p,blk=$iter||nil;return $iter&&(TMP_Tms_add_15.$$p=null),$iter&&(TMP_Tms_add_15.$$p=null),$rb_plus(this,$send($$($nesting,"Benchmark"),"measure",[],blk.$to_proc()))},TMP_Tms_add_15.$$arity=0),Opal.def(self,"$add!",TMP_Tms_add$B_16=function(){var $iter=TMP_Tms_add$B_16.$$p,blk=$iter||nil,t=nil;return $iter&&(TMP_Tms_add$B_16.$$p=null),$iter&&(TMP_Tms_add$B_16.$$p=null),t=$send($$($nesting,"Benchmark"),"measure",[],blk.$to_proc()),this.utime=$rb_plus(this.$utime(),t.$utime()),this.stime=$rb_plus(this.$stime(),t.$stime()),this.cutime=$rb_plus(this.$cutime(),t.$cutime()),this.cstime=$rb_plus(this.$cstime(),t.$cstime()),this.real=$rb_plus(this.$real(),t.$real()),this},TMP_Tms_add$B_16.$$arity=0),Opal.def(self,"$+",TMP_Tms_$_17=function(other){return this.$memberwise("+",other)},TMP_Tms_$_17.$$arity=1),Opal.def(self,"$-",TMP_Tms_$_18=function(other){return this.$memberwise("-",other)},TMP_Tms_$_18.$$arity=1),Opal.def(self,"$*",TMP_Tms_$_19=function(x){return this.$memberwise("*",x)},TMP_Tms_$_19.$$arity=1),Opal.def(self,"$/",TMP_Tms_$_20=function(x){return this.$memberwise("/",x)},TMP_Tms_$_20.$$arity=1),Opal.def(self,"$format",TMP_Tms_format_21=function($a,$b){var $post_args,format,args,$c,TMP_22,TMP_23,TMP_24,TMP_25,TMP_26,TMP_27,TMP_28,str=nil;return 0<($post_args=Opal.slice.call(arguments,0,arguments.length)).length&&(format=$post_args[0],$post_args.splice(0,1)),null==format&&(format=nil),args=$post_args,str=$send($send($send($send($send($send($send(($truthy($c=format)?$c:$$($nesting,"FORMAT")).$dup(),"gsub",[/(%[-+.\d]*)n/],((TMP_22=function(){var $d,self=TMP_22.$$s||this;return((($d=$gvars["~"])===nil?nil:$d["$[]"](1))+"s")["$%"](self.$label())}).$$s=this,TMP_22.$$arity=0,TMP_22)),"gsub",[/(%[-+.\d]*)u/],((TMP_23=function(){var $d,self=TMP_23.$$s||this;return((($d=$gvars["~"])===nil?nil:$d["$[]"](1))+"f")["$%"](self.$utime())}).$$s=this,TMP_23.$$arity=0,TMP_23)),"gsub",[/(%[-+.\d]*)y/],((TMP_24=function(){var $d,self=TMP_24.$$s||this;return((($d=$gvars["~"])===nil?nil:$d["$[]"](1))+"f")["$%"](self.$stime())}).$$s=this,TMP_24.$$arity=0,TMP_24)),"gsub",[/(%[-+.\d]*)U/],((TMP_25=function(){var $d,self=TMP_25.$$s||this;return((($d=$gvars["~"])===nil?nil:$d["$[]"](1))+"f")["$%"](self.$cutime())}).$$s=this,TMP_25.$$arity=0,TMP_25)),"gsub",[/(%[-+.\d]*)Y/],((TMP_26=function(){var $d,self=TMP_26.$$s||this;return((($d=$gvars["~"])===nil?nil:$d["$[]"](1))+"f")["$%"](self.$cstime())}).$$s=this,TMP_26.$$arity=0,TMP_26)),"gsub",[/(%[-+.\d]*)t/],((TMP_27=function(){var $d,self=TMP_27.$$s||this;return((($d=$gvars["~"])===nil?nil:$d["$[]"](1))+"f")["$%"](self.$total())}).$$s=this,TMP_27.$$arity=0,TMP_27)),"gsub",[/(%[-+.\d]*)r/],((TMP_28=function(){var $d,self=TMP_28.$$s||this;return("("+(($d=$gvars["~"])===nil?nil:$d["$[]"](1))+"f)")["$%"](self.$real())}).$$s=this,TMP_28.$$arity=0,TMP_28)),$truthy(format)?str["$%"](args):str},TMP_Tms_format_21.$$arity=-1),Opal.def(self,"$to_s",TMP_Tms_to_s_29=function(){return this.$format()},TMP_Tms_to_s_29.$$arity=0),Opal.def(self,"$to_a",TMP_Tms_to_a_30=function(){return[this.label,this.utime,this.stime,this.cutime,this.cstime,this.real]},TMP_Tms_to_a_30.$$arity=0),self.$protected(),Opal.def(self,"$memberwise",TMP_Tms_memberwise_31=function(op,x){var self=this,$case=nil;return $case=x,$$$($$($nesting,"Benchmark"),"Tms")["$==="]($case)?$$$($$($nesting,"Benchmark"),"Tms").$new(self.$utime().$__send__(op,x.$utime()),self.$stime().$__send__(op,x.$stime()),self.$cutime().$__send__(op,x.$cutime()),self.$cstime().$__send__(op,x.$cstime()),self.$real().$__send__(op,x.$real())):$$$($$($nesting,"Benchmark"),"Tms").$new(self.$utime().$__send__(op,x),self.$stime().$__send__(op,x),self.$cutime().$__send__(op,x),self.$cstime().$__send__(op,x),self.$real().$__send__(op,x))},TMP_Tms_memberwise_31.$$arity=2)}($nesting[0],0,$nesting),Opal.const_set($nesting[0],"CAPTION",$$$($$$($$($nesting,"Benchmark"),"Tms"),"CAPTION")),Opal.const_set($nesting[0],"FORMAT",$$$($$$($$($nesting,"Benchmark"),"Tms"),"FORMAT"))}($nesting[0],$nesting)};
