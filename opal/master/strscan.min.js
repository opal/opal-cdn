Opal.queue((function(Opal){var $klass=Opal.klass,$def=Opal.def,$truthy=Opal.truthy,$eqeqeq=Opal.eqeqeq,$Opal=Opal.Opal,$return_ivar=Opal.return_ivar,$send=Opal.send,$alias=Opal.alias,$nesting=[],nil=Opal.nil;return Opal.add_stubs("attr_reader,anchor,empty?,===,to_s,coerce_to!,scan_until,length,size,rest,pos=,beginning_of_line?,get_byte,private"),function($base,$super,$parent_nesting){var self=$klass($base,null,"StringScanner"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),$proto=self.$$prototype;return $proto.pos=$proto.string=$proto.working=$proto.matched=$proto.prev_pos=$proto.match=nil,self.$attr_reader("pos","matched"),$def(self,"$initialize",(function(string){return this.string=string,this.pos=0,this.matched=nil,this.working=string,this.match=[]})),self.$attr_reader("string"),$def(self,"$beginning_of_line?",(function(){return 0===this.pos||"\n"===this.string.charAt(this.pos-1)})),$def(self,"$scan",(function(pattern){var result=(pattern=this.$anchor(pattern)).exec(this.working);return null==result?this.matched=nil:(this.prev_pos=this.pos,this.pos+=result[0].length,this.working=this.working.substring(result[0].length),this.matched=result[0],this.match=result,result[0])})),$def(self,"$scan_until",(function(pattern){pattern=this.$anchor(pattern);for(var working=this.working,i=0;working.length!=i;++i){var result=pattern.exec(working.substr(i));if(null!==result){var matched_size=i+result[0].length,matched=working.substr(0,matched_size);return this.matched=result[0],this.match=result,this.prev_pos=this.pos+i,this.pos+=matched_size,this.working=working.substr(matched_size),matched}}return this.matched=nil})),$def(self,"$[]",(function(idx){var $ret_or_1;if($truthy(this.match["$empty?"]()))return nil;$eqeqeq($$("Symbol"),$ret_or_1=idx)?idx=idx.$to_s():$eqeqeq($$("String"),$ret_or_1)||(idx=$Opal["$coerce_to!"](idx,$$("Integer"),"to_int"));var match=this.match;return idx<0&&(idx+=match.length),idx<0||idx>=match.length||null==match[idx]?nil:match[idx]})),$def(self,"$check",(function(pattern){var result=(pattern=this.$anchor(pattern)).exec(this.working);return this.matched=null==result?nil:result[0]})),$def(self,"$check_until",(function(pattern){var old_prev_pos=this.prev_pos,old_pos=this.pos,old_working=this.working,result=this.$scan_until(pattern);return this.prev_pos=old_prev_pos,this.pos=old_pos,this.working=old_working,result})),$def(self,"$peek",(function(length){return this.working.substring(0,length)})),$def(self,"$eos?",(function(){return 0===this.working.length})),$def(self,"$exist?",(function(pattern){var result=pattern.exec(this.working);return null==result?nil:0==result.index?0:result.index+1})),$def(self,"$skip",(function(pattern){var result=(pattern=this.$anchor(pattern)).exec(this.working);if(null==result)return this.match=[],this.matched=nil;var match_str=result[0],match_len=match_str.length;return this.matched=match_str,this.match=result,this.prev_pos=this.pos,this.pos+=match_len,this.working=this.working.substring(match_len),match_len})),$def(self,"$skip_until",(function(pattern){var result=this.$scan_until(pattern);return result===nil?nil:(this.matched=result.substr(-1),result.length)})),$def(self,"$get_byte",(function(){var result=nil;return this.pos<this.string.length?(this.prev_pos=this.pos,this.pos+=1,result=this.matched=this.working.substring(0,1),this.working=this.working.substring(1)):this.matched=nil,result})),$def(self,"$match?",(function(pattern){var result=(pattern=this.$anchor(pattern)).exec(this.working);return null==result?nil:(this.prev_pos=this.pos,result[0].length)})),$def(self,"$pos=",(function(pos){return pos<0&&(pos+=this.string.$length()),this.pos=pos,this.working=this.string.slice(pos)})),$def(self,"$matched_size",(function(){return this.matched===nil?nil:this.matched.length})),$def(self,"$post_match",(function(){return this.matched===nil?nil:this.string.substr(this.pos)})),$def(self,"$pre_match",(function(){return this.matched===nil?nil:this.string.substr(0,this.prev_pos)})),$def(self,"$reset",(function(){return this.working=this.string,this.matched=nil,this.pos=0})),$def(self,"$rest",$return_ivar("working")),$def(self,"$rest?",(function(){return 0!==this.working.length})),$def(self,"$rest_size",(function(){return this.$rest().$size()})),$def(self,"$terminate",(function(){var $a;return this.match=nil,$a=[this.string.$length()],$send(this,"pos=",$a),$a[$a.length-1]})),$def(self,"$unscan",(function(){return this.pos=this.prev_pos,this.prev_pos=nil,this.match=nil,this})),$alias(self,"bol?","beginning_of_line?"),$alias(self,"getch","get_byte"),self.$private(),$def(self,"$anchor",(function(pattern){var flags=pattern.toString().match(/\/([^\/]+)$/);return flags=flags?flags[1]:void 0,new RegExp("^(?:"+pattern.source+")",flags)}))}($nesting[0],0,$nesting)}));
