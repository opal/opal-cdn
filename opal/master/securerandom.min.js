Opal.modules["corelib/random/formatter"]=function(Opal){var $klass=Opal.klass,$module=Opal.module,$def=Opal.def,$range=Opal.range,$send=Opal.send,$rb_divide=Opal.rb_divide,$Kernel=Opal.Kernel,$Opal=Opal.Opal,nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("_verify_count,bytes,encode,strict_encode64,random_bytes,urlsafe_encode64,split,hex,[]=,[],map,to_proc,join,times,<<,|,ord,/,abs,random_float,raise,coerce_to!,flatten,new,random_number,length,include,extend"),function($base,$super,$parent_nesting){var self=$klass("::",null,"Random"),$nesting=[self].concat($parent_nesting);return function($base,$parent_nesting){var self=$module($base,"Formatter"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);$def(self,"$hex",(function(count){null==count&&(count=nil),count=$$$("Random").$_verify_count(count);for(var bytes=this.$bytes(count),out="",i=0;i<count;i++)out+=bytes.charCodeAt(i).toString(16).padStart(2,"0");return out.$encode("US-ASCII")}),-1),$def(self,"$random_bytes",(function(count){return null==count&&(count=nil),this.$bytes(count)}),-1),$def(self,"$base64",(function(count){return null==count&&(count=nil),$$$("Base64").$strict_encode64(this.$random_bytes(count)).$encode("US-ASCII")}),-1),$def(self,"$urlsafe_base64",(function(count,padding){return null==count&&(count=nil),null==padding&&(padding=!1),$$$("Base64").$urlsafe_encode64(this.$random_bytes(count),padding).$encode("US-ASCII")}),-1),$def(self,"$uuid",(function(){var str=nil;return(str=this.$hex(16).$split(""))["$[]="](12,"4"),str["$[]="](16,(3&parseInt(str["$[]"](16),16)|8).toString(16)),str=[str["$[]"]($range(0,8,!0)),str["$[]"]($range(8,12,!0)),str["$[]"]($range(12,16,!0)),str["$[]"]($range(16,20,!0)),str["$[]"]($range(20,32,!0))],(str=$send(str,"map",[],"join".$to_proc())).$join("-")})),$def(self,"$random_float",(function(){var bs=nil,num=nil;return bs=this.$bytes(4),num=0,$send(4,"times",[],(function(i){return null==i&&(i=nil),num=(num=num["$<<"](8))["$|"](bs["$[]"](i).$ord())})),$rb_divide(num.$abs(),2147483647)})),$def(self,"$random_number",(function(limit){var self=this;function randomFloat(){return self.$random_float()}function randomInt(max){return Math.floor(randomFloat()*max)}return null==limit?randomFloat():limit.$$is_range?function(){var min=limit.begin,max=limit.end;if(min===nil||max===nil)return nil;var length=max-min;return length<0?nil:0===length?min:(max%1!=0||min%1!=0||limit.excl||length++,randomInt(length)+min)}():limit.$$is_number?(limit<=0&&$Kernel.$raise($$$("ArgumentError"),"invalid argument - "+limit),limit%1==0?randomInt(limit):randomFloat()*limit):((limit=$Opal["$coerce_to!"](limit,$$$("Integer"),"to_int"))<=0&&$Kernel.$raise($$$("ArgumentError"),"invalid argument - "+limit),randomInt(limit))}),-1),$def(self,"$alphanumeric",(function(count){var map=nil;return null==count&&(count=nil),count=$$("Random").$_verify_count(count),map=$send([$range("0","9",!1),$range("a","z",!1),$range("A","Z",!1)],"map",[],"to_a".$to_proc()).$flatten(),$send($$$("Array"),"new",[count],(function $$2(i){var self=null==$$2.$$s?this:$$2.$$s;return null==i&&(i=nil),map["$[]"](self.$random_number(map.$length()))}),{$$s:this}).$join()}),-1)}(self,$nesting),self.$include($$$($$$("Random"),"Formatter")),self.$extend($$$($$$("Random"),"Formatter"))}(0,0,[])},Opal.queue((function(Opal){var $module=Opal.module,$defs=Opal.defs,self=Opal.top,$nesting=[],nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("require,extend,warn,rand,gen_random,_verify_count,encode"),self.$require("corelib/random/formatter"),function($base,$parent_nesting){var gen_random_bytes,self=$module($base,"SecureRandom"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);if(self.$extend($$$($$("Random"),"Formatter")),Opal.global.crypto&&Opal.global.crypto.getRandomValues||Opal.global.msCrypto&&Opal.global.msCrypto.getRandomValues){var crypto=Opal.global.crypto||Opal.global.msCrypto;gen_random_bytes=function(count){var storage=new Uint8Array(count);return crypto.getRandomValues(storage),storage}}else Opal.global.crypto&&Opal.global.crypto.randomBytes?gen_random_bytes=function(count){return Opal.global.crypto.randomBytes(count)}:(self.$warn("Can't get a Crypto.getRandomValues interface or Crypto.randomBytes.The random values generated with SecureRandom won't be cryptographically secure"),gen_random_bytes=function(count){for(var storage=new Uint8Array(count),i=0;i<count;i++)storage[i]=self.$rand(255)^Math.floor(256*Math.random()),storage[i]^=+new Date>>self.$rand(255)&255;return storage});return $defs(self,"$bytes",(function(bytes){return null==bytes&&(bytes=nil),this.$gen_random(bytes)}),-1),$defs(self,"$gen_random",(function(count){var out=nil;null==count&&(count=nil),count=$$("Random").$_verify_count(count),out="";for(var bytes=gen_random_bytes(count),i=0;i<count;i++)out+=String.fromCharCode(bytes[i]);return out.$encode("ASCII-8BIT")}),-1)}($nesting[0],$nesting)}));
