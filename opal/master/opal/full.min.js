Opal.modules["corelib/trace_point"]=function(Opal){var self,$proto,$klass=Opal.klass,$send=Opal.send,$defs=Opal.defs,$eqeq=Opal.eqeq,$Kernel=Opal.Kernel,$def=Opal.def,$slice=Opal.slice,$return_ivar=Opal.return_ivar,nil=Opal.nil;return Opal.add_stubs("enable,new,to_proc,attr_reader,==,raise,enabled?,disable"),self=$klass("::",null,"TracePoint"),($proto=self.$$prototype).event=$proto.tracers_for_evt=$proto.trace_evt=nil,$defs(self,"$trace",(function $$trace(event){var block=$$trace.$$p||nil;return $$trace.$$p=null,$send(this,"new",[event],block.$to_proc()).$enable()}),1),self.$attr_reader("event"),$def(self,"$initialize",(function $$initialize(event){var block=$$initialize.$$p||nil;return $$initialize.$$p=null,$eqeq(event,"class")||$Kernel.$raise("Only the :class event is supported"),this.event=event,this.block=block,this.trace_object=nil,this.trace_evt="trace_"+this.event,this.tracers_for_evt="tracers_for_"+this.event}),1),$def(self,"$enable",(function $$enable($a){var enable_block=$$enable.$$p||nil,self=this,previous_state=nil;return $$enable.$$p=null,$slice.call(arguments),previous_state=self["$enabled?"](),Opal[self.tracers_for_evt].push(self),Opal[self.trace_evt]=!0,enable_block!==nil&&(Opal.yieldX(enable_block,[]),self.$disable()),previous_state}),-1),$def(self,"$enabled?",(function(){return Opal[this.trace_evt]&&Opal[this.tracers_for_evt].includes(this)}),0),$def(self,"$disable",(function(){var idx=Opal[this.tracers_for_evt].indexOf(this);return idx>-1&&(Opal[this.tracers_for_evt].splice(idx,1),0===Opal[this.tracers_for_evt].length&&(Opal[this.trace_evt]=!1),!0)}),0),$def(self,"$self",$return_ivar("trace_object"),0)},Opal.modules["corelib/pattern_matching/base"]=function(Opal){var self,$klass=Opal.klass,$return_self=Opal.return_self,$def=Opal.def,$alias=Opal.alias,$truthy=Opal.truthy,$eqeqeq=Opal.eqeqeq,$Kernel=Opal.Kernel,$rb_gt=Opal.rb_gt,$hash2=Opal.hash2,$send=Opal.send,$rb_lt=Opal.rb_lt,$thrower=Opal.thrower,nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("to_a,nil?,to_h,===,raise,>,length,values,each,<,!,include?,members,[]=,[]"),self=$klass("::",null,"Array"),$def(self,"$deconstruct",$return_self,0),function($base,$super){var self=$klass("::",null,"Hash");$def(self,"$deconstruct_keys",$return_self,0)}(),function($base,$super){var self=$klass("::",null,"Struct");$alias(self,"deconstruct","to_a"),$def(self,"$deconstruct_keys",(function(keys){var out,self=this;return $truthy(keys["$nil?"]())?self.$to_h():($eqeqeq($$$("Array"),keys)||$Kernel.$raise($$$("TypeError"),"expected Array or nil"),$truthy($rb_gt(keys.$length(),self.$values().$length()))?$hash2([],{}):(out=$hash2([],{}),function(){try{var $t_break=$thrower("break");$send(keys,"each",[],(function $$1(key){var $a,should_break,$ret_or_1,self=null==$$1.$$s?this:$$1.$$s;return null==key&&(key=nil),should_break=$eqeqeq($$$("Integer"),$ret_or_1=key)?$rb_lt(self.$values().$length(),key):$eqeqeq($$$("Symbol"),$ret_or_1)?self.$members()["$include?"](key)["$!"]():nil,$truthy(should_break)&&$t_break.$throw(),$a=[key,self["$[]"](key)],$send(out,"[]=",$a),$a[$a.length-1]}),{$$arity:1,$$s:self})}catch($e){if($e===$t_break)return $e.$v;throw $e}}(),out))}),1)}(),$klass("::",$$$("StandardError"),"NoMatchingPatternError"),nil},Opal.modules["corelib/pattern_matching"]=function(Opal){var $klass=Opal.klass,$truthy=Opal.truthy,$defs=Opal.defs,$def=Opal.def,$eqeq=Opal.eqeq,$to_a=Opal.to_a,$slice=Opal.slice,$send=Opal.send,$neqeq=Opal.neqeq,$rb_lt=Opal.rb_lt,$to_ary=Opal.to_ary,$rb_minus=Opal.rb_minus,$rb_plus=Opal.rb_plus,$not=Opal.not,$thrower=Opal.thrower,self=Opal.top,nil=Opal.nil;return Opal.add_stubs("require,new,match,returns,attr_reader,==,<<,[],===,any?,all?,respond_to?,deconstruct,!=,length,<,each_with_index,-,size,+,dup,times,to_h,deconstruct_keys,keys,key?,except,!,empty?"),self.$require("corelib/pattern_matching/base"),function($base,$super){var self=$klass("::",null,"PatternMatching"),$proto=self.$$prototype;return $proto.from=$proto.pattern=$proto.returns=nil,$defs(self,"$call",(function(from,pattern){var pm=nil;return pm=this.$new(from,pattern),$truthy(pm.$match())?pm.$returns():nil}),2),$def(self,"$initialize",(function(from,pattern){var $a;return $a=[from,pattern],this.from=$a[0],this.pattern=$a[1],this.returns=[]}),2),self.$attr_reader("returns"),$def(self,"$match",(function(from,pattern){try{var $a,$b,$t_return=$thrower("return"),type=nil,args=nil,fixed_size=nil,array_size=nil,array_match=nil,a=nil,skip_elems=nil,skip_rests=nil,find_match=nil,first=nil,last=nil,pattern_length=nil,a_length=nil,returns_backup=nil,iterations=nil,any_size=nil,hash_match=nil;if(null==from&&(from=this.from),null==pattern&&(pattern=this.pattern),$eqeq(pattern,"var"))return this.returns["$<<"](from),!0;switch($a=[].concat($to_a(pattern)),type=null==$a[0]?nil:$a[0],args=$slice.call($a,1),type){case"save":return this.returns["$<<"](from),this.$match(from,args["$[]"](0));case"lit":return args["$[]"](0)["$==="](from);case"any":return $send(args,"any?",[],(function $$1(arg){return null==arg&&(arg=nil),(null==$$1.$$s?this:$$1.$$s).$match(from,arg)}),{$$arity:1,$$s:this});case"all":return $send(args,"all?",[],(function $$2(arg){return null==arg&&(arg=nil),(null==$$2.$$s?this:$$2.$$s).$match(from,arg)}),{$$arity:1,$$s:this});case"array":return fixed_size=null==($a=[].concat($to_a(args)))[0]?nil:$a[0],array_size=null==$a[1]?nil:$a[1],array_match=null==$a[2]?nil:$a[2],$truthy(from["$respond_to?"]("deconstruct"))?(a=from.$deconstruct(),(!$truthy(fixed_size)||!$neqeq(a.$length(),array_size))&&(!$truthy($rb_lt(a.$length(),array_size))&&(skip_elems=0,skip_rests=0,$send(array_match.$each_with_index(),"all?",[],(function $$3(elem,i){var $b,self=null==$$3.$$s?this:$$3.$$s;return null==elem&&(elem=nil),null==i&&(i=nil),$b=$to_ary(elem),type=null==$b[0]?nil:$b[0],args=$slice.call($b,1),"rest"===type?(skip_elems=$rb_minus(a.$size(),array_size),skip_rests=1,$truthy(args["$[]"](0))&&self.$match(a["$[]"](Opal.Range.$new(i,$rb_plus(i,skip_elems),!0)),args["$[]"](0)),!0):self.$match(a["$[]"]($rb_minus($rb_plus(i,skip_elems),skip_rests)),elem)}),{$$arity:2,$$s:this})))):!1;case"find":return $a=[].concat($to_a(args)),find_match=null==$a[0]?nil:$a[0],$a=[].concat($to_a(find_match)),first=null==$a[0]?nil:$a[0],$b=($b=$a.length-1)<1?1:$b,find_match=$slice.call($a,1,$b),last=null==$a[$b]?nil:$a[$b],pattern_length=find_match.$length(),$truthy(from["$respond_to?"]("deconstruct"))?(a_length=(a=from.$deconstruct()).$length(),!$truthy($rb_lt(a_length,pattern_length))&&(returns_backup=this.returns.$dup(),$a=[first["$[]"](1),last["$[]"](1)],first=$a[0],last=$a[1],iterations=$rb_plus($rb_minus(a_length,pattern_length),1),$send(iterations.$times(),"any?",[],(function $$4(skip){var first_part,last_part,success,self=null==$$4.$$s?this:$$4.$$s,content=nil;return null==skip&&(skip=nil),first_part=a["$[]"](0,skip),content=a["$[]"](skip,pattern_length),last_part=a["$[]"](Opal.Range.$new($rb_plus(skip,pattern_length),-1,!1)),$truthy(first)&&self.$match(first_part,first),success=$send(content.$each_with_index(),"all?",[],(function $$5(e,i){return null==e&&(e=nil),null==i&&(i=nil),(null==$$5.$$s?this:$$5.$$s).$match(e,find_match["$[]"](i))}),{$$arity:2,$$s:self}),$truthy(last)&&self.$match(last_part,last),$truthy(success)||(self.returns=returns_backup.$dup()),success}),{$$arity:1,$$s:this}))):!1;case"hash":if(any_size=null==($a=[].concat($to_a(args)))[0]?nil:$a[0],hash_match=(hash_match=null==$a[1]?nil:$a[1]).$to_h(),!$truthy(from["$respond_to?"]("deconstruct_keys")))return!1;if(a=$truthy(any_size)&&$neqeq(any_size,!0)?from.$deconstruct_keys(nil):from.$deconstruct_keys(hash_match.$keys()),!$truthy($send(hash_match,"all?",[],(function $$6(k,v){var self=null==$$6.$$s?this:$$6.$$s;return null==k&&(k=nil),null==v&&(v=nil),$truthy(a["$key?"](k))||$t_return.$throw(!1),self.$match(a["$[]"](k),v)}),{$$arity:2,$$s:this,$$ret:$t_return})))return!1;if($truthy(any_size)&&$neqeq(any_size,!0))this.$match($send(a,"except",$to_a(hash_match.$keys())),args["$[]"](0));else if($not(any_size)&&!$truthy($send(a,"except",$to_a(hash_match.$keys()))["$empty?"]()))return!1;return!0;default:return nil}}catch($e){if($e===$t_return)return $e.$v;throw $e}}),-1)}()},Opal.modules["corelib/object_space"]=function(Opal){var $respond_to=Opal.respond_to,$truthy=Opal.truthy,$module=Opal.module,$Kernel=Opal.Kernel,$def=Opal.def,$klass=Opal.klass,$hash2=Opal.hash2,$send=Opal.send,$slice=Opal.slice,$alias=Opal.alias,nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("module_function,call,proc,raise,class,__id__,include,[],[]=,key?,each,define_method,include?"),function($base){var self=$module("::","ObjectSpace");self.$module_function();var registry,add_caller,delete_callers,callers={};return"function"==typeof FinalizationRegistry?(registry=new FinalizationRegistry((function(id){if(void 0!==callers[id]){for(var i=0;i<callers[id].length;i++)callers[id][i].$call(id);delete callers[id]}})),add_caller=function(id,value){callers[id]=callers[id]||[],callers[id].push(value)},delete_callers=function(id){delete callers[id]}):(registry={register:function(){},unregister:function(){}},add_caller=function(){},delete_callers=function(){}),$def(self,"$define_finalizer",(function $$define_finalizer(obj,aproc){var block=$$define_finalizer.$$p||nil;$$define_finalizer.$$p=null,$truthy(block)&&(aproc=block),$truthy(aproc)||(aproc=$Kernel.$proc()),$respond_to(aproc,"$call")||$Kernel.$raise($$$("ArgumentError"),"Wrong type argument "+aproc.$class()+" (should be callable)");var id=obj.$__id__();add_caller(id,aproc);try{registry.register(obj,id,obj)}catch(e){delete_callers(id),$Kernel.$raise($$$("ArgumentError"),"cannot define finalizer for "+obj.$class())}return[0,aproc]}),-2),$def(self,"$undefine_finalizer",(function(obj){return"\n      var id = "+obj.$__id__()+";\n      registry.unregister(obj);\n      delete_callers(id);\n      return obj;\n    "}),1),function($base,$super){var self=$klass($base,null,"WeakMap"),$proto=self.$$prototype;return $proto.primitive_map=$proto.weak_map=nil,self.$include($$$("Enumerable")),$def(self,"$initialize",(function(){return this.weak_map=new WeakMap,this.primitive_map=$hash2([],{})}),0),$def(self,"$[]",(function(p1){return"function"!=typeof p1&&"object"!=typeof p1?this.primitive_map["$[]"](p1):this.weak_map.get(p1)}),1),$def(self,"$[]=",(function(p1,p2){var $a;return"function"!=typeof p1&&"object"!=typeof p1?($a=[p1,p2],$send(this.primitive_map,"[]=",$a),$a[$a.length-1]):this.weak_map.set(p1,p2)}),2),$def(self,"$include?",(function(p1){return"function"!=typeof p1&&"object"!=typeof p1?this.primitive_map["$key?"](p1):this.weak_map.has(p1)}),1),$send(["each","each_key","each_value","each_pair","keys","values","size","length"],"each",[],(function $WeakMap$4(i){return null==i&&(i=nil),$send(null==$WeakMap$4.$$s?this:$WeakMap$4.$$s,"define_method",[i],(function($a){return $slice.call(arguments),$Kernel.$raise($$$("NotImplementedError"),"#"+i+" can't be implemented on top of JS interfaces")}),-1)}),{$$arity:1,$$s:self}),$alias(self,"member?","include?"),$alias(self,"key?","include?")}(self)}()},Opal.modules["corelib/array/pack"]=function(Opal){var $coerce_to=Opal.coerce_to,$klass=Opal.klass,$Kernel=Opal.Kernel,$Opal=Opal.Opal,$def=Opal.def,self=Opal.top,nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("require,raise,delete,gsub,coerce_to!,inspect"),self.$require("corelib/pack_unpack/format_string_parser"),function($base,$super){var self=$klass("::",null,"Array"),eachDirectiveAndCount=Opal.PackUnpack.eachDirectiveAndCount;function identityFunction(value){return value}function asciiBytesToUtf16LEString(bytes){return String.fromCharCode.apply(null,bytes)}function asciiStringFromUnsignedInt(bytes,callback){return function(data){return callback(data).map((function(item){for(var result=[],i=0;i<bytes;i++){var bit=255&item;result.push(bit),item>>=8}return asciiBytesToUtf16LEString(result)}))}}function asciiStringFromSignedInt(bytes,callback){return function(data){var buffer=callback(data),bits=8*bytes,limit=Math.pow(2,bits);return buffer.map((function(item){item<0&&(item+=limit);for(var result=[],i=0;i<bytes;i++){var bit=255&item;result.push(bit),item>>=8}return asciiBytesToUtf16LEString(result)}))}}function toInt(callback){return function(data){return callback(data).map((function(item){return $coerce_to(item,$$$("Integer"),"to_int")}))}}function joinChars(callback){return function(data){return callback(data).join("")}}var callback,handlers={C:joinChars(asciiStringFromUnsignedInt(1,toInt(identityFunction))),S:joinChars(asciiStringFromUnsignedInt(2,toInt(identityFunction))),L:joinChars(asciiStringFromUnsignedInt(4,toInt(identityFunction))),Q:joinChars(asciiStringFromUnsignedInt(8,toInt(identityFunction))),J:null,"S>":null,"L>":null,"Q>":null,c:joinChars(asciiStringFromSignedInt(1,toInt(identityFunction))),s:joinChars(asciiStringFromSignedInt(2,toInt(identityFunction))),l:joinChars(asciiStringFromSignedInt(4,toInt(identityFunction))),q:joinChars(asciiStringFromSignedInt(8,toInt(identityFunction))),j:null,"s>":null,"l>":null,"q>":null,n:null,N:null,v:null,V:null,U:joinChars((callback=toInt(identityFunction),function(data){return callback(data).map((function(item){try{return String.fromCodePoint(item)}catch(error){throw error instanceof RangeError&&$Kernel.$raise($$$("RangeError"),"value out of range"),error}}))})),w:null,D:null,d:null,F:null,f:null,E:null,e:null,G:null,g:null,A:joinChars(identityFunction),a:joinChars(identityFunction),Z:null,B:null,b:null,H:null,h:null,u:null,M:null,m:null,P:null,p:null};function readNTimesFromBufferAndMerge(callback){return function(buffer,count){var chunkData,chunk=[];if(count===1/0)for(;buffer.length>0;)buffer=(chunkData=callback(buffer)).rest,chunk=chunk.concat(chunkData.chunk);else{buffer.length<count&&$Kernel.$raise($$$("ArgumentError"),"too few arguments");for(var i=0;i<count;i++)buffer=(chunkData=callback(buffer)).rest,chunk=chunk.concat(chunkData.chunk)}return{chunk:chunk,rest:buffer}}}function readItem(buffer){return{chunk:buffer.slice(0,1),rest:buffer=buffer.slice(1,buffer.length)}}function readNCharsFromTheFirstItemAndMergeWithFallback(fallback,callback){return function(buffer,count){var chunk=[],source=buffer[0];function infiniteReeder(){var chunkData=callback(source);source=chunkData.rest;var subChunk=chunkData.chunk;1===subChunk.length&&subChunk[0]===nil&&(subChunk=[]),chunk=chunk.concat(subChunk)}function finiteReeder(){var chunkData=callback(source);source=chunkData.rest;var subChunk=chunkData.chunk;0===subChunk.length&&(subChunk=[fallback]),1===subChunk.length&&subChunk[0]===nil&&(subChunk=[fallback]),chunk=chunk.concat(subChunk)}if(source===nil?source="":void 0===source?$Kernel.$raise($$$("ArgumentError"),"too few arguments"):source=$coerce_to(source,$$$("String"),"to_str"),buffer=buffer.slice(1,buffer.length),count===1/0)for(;source.length>0;)infiniteReeder();else for(var i=0;i<count;i++)finiteReeder();return{chunk:chunk,rest:buffer}}}var readChunk={C:readNTimesFromBufferAndMerge(readItem),S:readNTimesFromBufferAndMerge(readItem),L:readNTimesFromBufferAndMerge(readItem),Q:readNTimesFromBufferAndMerge(readItem),J:null,"S>":null,"L>":null,"Q>":null,c:readNTimesFromBufferAndMerge(readItem),s:readNTimesFromBufferAndMerge(readItem),l:readNTimesFromBufferAndMerge(readItem),q:readNTimesFromBufferAndMerge(readItem),j:null,"s>":null,"l>":null,"q>":null,n:null,N:null,v:null,V:null,U:readNTimesFromBufferAndMerge(readItem),w:null,D:null,d:null,F:null,f:null,E:null,e:null,G:null,g:null,A:readNCharsFromTheFirstItemAndMergeWithFallback(" ",readItem),a:readNCharsFromTheFirstItemAndMergeWithFallback("\0",readItem),Z:null,B:null,b:null,H:null,h:null,u:null,M:null,m:null,P:null,p:null},autocompletion={C:!1,S:!1,L:!1,Q:!1,J:null,"S>":null,"L>":null,"Q>":null,c:!1,s:!1,l:!1,q:!1,j:null,"s>":null,"l>":null,"q>":null,n:null,N:null,v:null,V:null,U:!1,w:null,D:null,d:null,F:null,f:null,E:null,e:null,G:null,g:null,A:!1,a:!1,Z:null,B:null,b:null,H:null,h:null,u:!1,M:null,m:null,P:null,p:null};return $def(self,"$pack",(function(format){format=$Opal["$coerce_to!"](format,$$$("String"),"to_str").$gsub(/\s/,"").$delete("\0");var output="",buffer=this.slice();return eachDirectiveAndCount(format,(function(directive,count){var part=function(directive,count){var chunk,chunkReader=readChunk[directive];null==chunkReader&&$Kernel.$raise("Unsupported pack directive "+directive.$inspect()+" (no chunk reader defined)");var chunkData=chunkReader(buffer,count);chunk=chunkData.chunk,buffer=chunkData.rest;var handler=handlers[directive];return null==handler&&$Kernel.$raise("Unsupported pack directive "+directive.$inspect()+" (no handler defined)"),handler(chunk)}(directive,count);if(count!==1/0){var shouldAutocomplete=autocompletion[directive];null==shouldAutocomplete&&$Kernel.$raise("Unsupported pack directive "+directive.$inspect()+" (no autocompletion rule defined)"),shouldAutocomplete&&function(array,size){for(;array.length<size;)array.push(nil)}(part,count)}output=output.concat(part)})),format.match(/^(U\*?)+$/)?output:Opal.enc(output,"binary")}),1)}()},Opal.modules["corelib/string/unpack"]=function(Opal){var $klass=Opal.klass,$Kernel=Opal.Kernel,$ensure_kwargs=Opal.ensure_kwargs,$truthy=Opal.truthy,$rb_lt=Opal.rb_lt,$Opal=Opal.Opal,$rb_gt=Opal.rb_gt,$def=Opal.def,$hash2=Opal.hash2,self=Opal.top,nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("require,flatten,decode64,raise,<,delete,gsub,coerce_to!,>,length,inspect,[],unpack"),self.$require("base64"),self.$require("corelib/pack_unpack/format_string_parser"),function($base,$super,$parent_nesting){var self=$klass("::",null,"String"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),expected=nil,given=nil,eachDirectiveAndCount=Opal.PackUnpack.eachDirectiveAndCount;function mapChunksToWords(callback){return function(data){return callback(data).map((function(chunk){return chunk.reverse().reduce((function(result,singleByte){return 256*result+singleByte}),0)}))}}function chunkBy(chunkSize,callback){return function(data){for(var array=callback(data),chunks=[],chunksCount=array.length/chunkSize,i=0;i<chunksCount;i++){var chunk=array.splice(0,chunkSize);chunk.length===chunkSize&&chunks.push(chunk)}return chunks}}function toNByteSigned(bytesCount,callback){return function(data){var unsignedBits=callback(data),bitsCount=8*bytesCount,limit=Math.pow(2,bitsCount);return unsignedBits.map((function(n){return n>=limit/2&&(n-=limit),n}))}}function bytesToAsciiChars(callback){return function(data){return callback(data).map((function(singleByte){return String.fromCharCode(singleByte)}))}}function joinChars(callback){return function(data){return callback(data).join("")}}function wrapIntoArray(callback){return function(data){return[callback(data)]}}var charCodesToFilter,filterTrailingZerosAndSpaces=(charCodesToFilter=["\0"," "].map((function(s){return s.charCodeAt(0)})),function(callback){return function(data){for(var charCodes=callback(data);-1!==charCodesToFilter.indexOf(charCodes[charCodes.length-1]);)charCodes=charCodes.slice(0,charCodes.length-1);return charCodes}});function invertChunks(callback){return function(data){return callback(data).map((function(chunk){return chunk.reverse()}))}}function identityFunction(value){return value}var callback,handlers={C:identityFunction,S:mapChunksToWords(chunkBy(2,identityFunction)),L:mapChunksToWords(chunkBy(4,identityFunction)),Q:mapChunksToWords(chunkBy(8,identityFunction)),J:null,"S>":mapChunksToWords(invertChunks(chunkBy(2,identityFunction))),"L>":mapChunksToWords(invertChunks(chunkBy(4,identityFunction))),"Q>":mapChunksToWords(invertChunks(chunkBy(8,identityFunction))),c:toNByteSigned(1,identityFunction),s:toNByteSigned(2,mapChunksToWords(chunkBy(2,identityFunction))),l:toNByteSigned(4,mapChunksToWords(chunkBy(4,identityFunction))),q:toNByteSigned(8,mapChunksToWords(chunkBy(8,identityFunction))),j:null,"s>":toNByteSigned(2,mapChunksToWords(invertChunks(chunkBy(2,identityFunction)))),"l>":toNByteSigned(4,mapChunksToWords(invertChunks(chunkBy(4,identityFunction)))),"q>":toNByteSigned(8,mapChunksToWords(invertChunks(chunkBy(8,identityFunction)))),n:null,N:null,v:null,V:null,U:identityFunction,w:(callback=identityFunction,function(data){for(var bytes=callback(data),result=[],buffer="",i=0;i<bytes.length;i++){var bits=bytes[i].toString(2),firstBit=(bits=Array(8-bits.length+1).join("0").concat(bits))[0];if(bits=bits.slice(1,bits.length),buffer=buffer.concat(bits),"0"===firstBit){var decoded=parseInt(buffer,2);result.push(decoded),buffer=""}}return result}),D:null,d:null,F:null,f:null,E:null,e:null,G:null,g:null,A:wrapIntoArray(joinChars(bytesToAsciiChars(filterTrailingZerosAndSpaces(identityFunction)))),a:wrapIntoArray(joinChars(bytesToAsciiChars(identityFunction))),Z:joinChars(bytesToAsciiChars(identityFunction)),B:joinChars(identityFunction),b:joinChars(identityFunction),H:joinChars(identityFunction),h:joinChars(identityFunction),u:joinChars(bytesToAsciiChars(function(callback){return function(data){for(var bytes=callback(data),i=0,length=0,result=[];;){if(!(i<bytes.length))break;var n=bytes[i]-32&63;if(10!==bytes[++i]){if(n>45)return"";for(length+=n;n>0;){var c1=bytes[i],c2=bytes[i+1],c3=bytes[i+2],b1=(c1-32&63)<<2|(c2-32&63)>>4,b2=(c2-32&63)<<4|(c3-32&63)>>2,b3=(c3-32&63)<<6|bytes[i+3]-32&63;result.push(255&b1),result.push(255&b2),result.push(255&b3),i+=4,n-=3}++i}}return result.slice(0,length)}}(identityFunction))),M:function(callback){return function(data){return callback(data).replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,(function($0,$1){var codePoint=parseInt($1,16);return String.fromCharCode(codePoint)}))}}(joinChars(bytesToAsciiChars(identityFunction))),m:function(callback){return function(data){return $$("Base64").$decode64(callback(data))}}(joinChars(bytesToAsciiChars(identityFunction))),P:null,p:null};function readBytes(n){return function(bytes){return{chunk:bytes.slice(0,n),rest:bytes=bytes.slice(n,bytes.length)}}}function readNTimesAndMerge(callback){return function(buffer,count){var chunkData,chunk=[];if(count===1/0)for(;buffer.length>0;)buffer=(chunkData=callback(buffer)).rest,chunk=chunk.concat(chunkData.chunk);else for(var i=0;i<count;i++)buffer=(chunkData=callback(buffer)).rest,chunk=chunk.concat(chunkData.chunk);return{chunk:chunk,rest:buffer}}}function readAll(buffer,count){return{chunk:buffer,rest:[]}}var readChunk={C:readNTimesAndMerge(readBytes(1)),S:readNTimesAndMerge(readBytes(2)),L:readNTimesAndMerge(readBytes(4)),Q:readNTimesAndMerge(readBytes(8)),J:null,"S>":readNTimesAndMerge(readBytes(2)),"L>":readNTimesAndMerge(readBytes(4)),"Q>":readNTimesAndMerge(readBytes(8)),c:readNTimesAndMerge(readBytes(1)),s:readNTimesAndMerge(readBytes(2)),l:readNTimesAndMerge(readBytes(4)),q:readNTimesAndMerge(readBytes(8)),j:null,"s>":readNTimesAndMerge(readBytes(2)),"l>":readNTimesAndMerge(readBytes(4)),"q>":readNTimesAndMerge(readBytes(8)),n:null,N:null,v:null,V:null,U:readNTimesAndMerge((function(bytes){var currentByteIndex=0,bytesLength=bytes.length;function readByte(){var result=bytes[currentByteIndex++];return bytesLength=bytes.length-currentByteIndex,result}var extraLength,c=readByte();if(c>>7==0)return{chunk:[c],rest:bytes.slice(currentByteIndex)};c>>6==2&&$Kernel.$raise($$$("ArgumentError"),"malformed UTF-8 character"),c>>5==6?extraLength=1:c>>4==14?extraLength=2:c>>3==30?extraLength=3:c>>2==62?extraLength=4:c>>1==126?extraLength=5:$Kernel.$raise("malformed UTF-8 character"),extraLength>bytesLength&&(expected=extraLength+1,given=bytesLength+1,$Kernel.$raise($$$("ArgumentError"),"malformed UTF-8 character (expected "+expected+" bytes, given "+given+" bytes)"));for(var result=c&(1<<8-extraLength-1)-1,i=0;i<extraLength;i++)(c=readByte())>>6!=2&&$Kernel.$raise("Invalid multibyte sequence"),result=result<<6|63&c;return result<=65535?{chunk:[result],rest:bytes.slice(currentByteIndex)}:{chunk:[55296+((result-=65536)>>10&1023),56320+(1023&result)],rest:bytes.slice(currentByteIndex)}})),w:readNTimesAndMerge((function(buffer){for(var result=[],i=0;i<buffer.length;i++){var singleByte=buffer[i];if(result.push(singleByte),0==(128&singleByte))break}return{chunk:result,rest:buffer.slice(result.length,buffer.length)}})),D:null,d:null,F:null,f:null,E:null,e:null,G:null,g:null,A:readNTimesAndMerge(readBytes(1)),a:readNTimesAndMerge(readBytes(1)),Z:function(buffer,count){for(var result=[],i=0;i<count&&i<buffer.length;i++){var singleByte=buffer[i];if(0===singleByte)break;result.push(singleByte)}return count===1/0&&(count=result.length),0===buffer[count]&&count++,{chunk:result,rest:buffer=buffer.slice(count,buffer.length)}},B:function(buffer,count){for(var result="";count>0&&buffer.length>0;){var singleByte=buffer[0],bitsToTake=Math.min(count,8);Math.ceil(bitsToTake/8);if(buffer=buffer.slice(1,buffer.length),null!=singleByte){var bits=singleByte.toString(2);bits=Array(8-bits.length+1).join("0").concat(bits);for(var j=0;j<bitsToTake;j++)result+=bits[j]||"0",count--}}return{chunk:[result],rest:buffer}},b:function(buffer,count){for(var result="";count>0&&buffer.length>0;){var singleByte=buffer[0],bitsToTake=Math.min(count,8);Math.ceil(bitsToTake/8);if(buffer=buffer.slice(1,buffer.length),null!=singleByte){var bits=singleByte.toString(2);bits=Array(8-bits.length+1).join("0").concat(bits).split("").reverse().join("");for(var j=0;j<bitsToTake;j++)result+=bits[j]||"0",count--}}return{chunk:[result],rest:buffer}},H:function(buffer,count){for(var result=[];count>0&&buffer.length>0;){var hex=buffer[0].toString(16);buffer=buffer.slice(1,buffer.length),hex=Array(2-hex.length+1).join("0").concat(hex),1===count?(result.push(hex[0]),count--):(result.push(hex[0],hex[1]),count-=2)}return{chunk:result,rest:buffer}},h:function(buffer,count){for(var result=[];count>0&&buffer.length>0;){var hex=buffer[0].toString(16);buffer=buffer.slice(1,buffer.length),hex=Array(2-hex.length+1).join("0").concat(hex),1===count?(result.push(hex[1]),count--):(result.push(hex[1],hex[0]),count-=2)}return{chunk:result,rest:buffer}},u:readNTimesAndMerge((function(buffer){var length=buffer.indexOf(32);return-1===length?{chunk:buffer,rest:[]}:{chunk:buffer.slice(0,length),rest:buffer.slice(length,buffer.length)}})),M:readAll,m:readAll,P:null,p:null},autocompletion={C:!0,S:!0,L:!0,Q:!0,J:null,"S>":!0,"L>":!0,"Q>":!0,c:!0,s:!0,l:!0,q:!0,j:null,"s>":!0,"l>":!0,"q>":!0,n:null,N:null,v:null,V:null,U:!1,w:!1,D:null,d:null,F:null,f:null,E:null,e:null,G:null,g:null,A:!1,a:!1,Z:!1,B:!1,b:!1,H:!1,h:!1,u:!1,M:!1,m:!1,P:null,p:null},optimized={"C*":handlers.C,"c*":handlers.c,"A*":handlers.A,"a*":handlers.a,"M*":wrapIntoArray(handlers.M),"m*":wrapIntoArray(handlers.m),"S*":handlers.S,"s*":handlers.s,"L*":handlers.L,"l*":handlers.l,"Q*":handlers.Q,"q*":handlers.q,"S>*":handlers["S>"],"s>*":handlers["s>"],"L>*":handlers["L>"],"l>*":handlers["l>"],"Q>*":handlers["Q>"],"q>*":handlers["q>"]};function alias(existingDirective,newDirective){readChunk[newDirective]=readChunk[existingDirective],handlers[newDirective]=handlers[existingDirective],autocompletion[newDirective]=autocompletion[existingDirective]}return alias("S>","n"),alias("L>","N"),alias("S","v"),alias("L","V"),$def(self,"$unpack",(function(format,$kwargs){var offset;null==(offset=($kwargs=$ensure_kwargs($kwargs)).$$smap.offset)&&(offset=0),$truthy($rb_lt(offset,0))&&$Kernel.$raise($$$("ArgumentError"),"offset can't be negative"),format=$Opal["$coerce_to!"](format,$$$("String"),"to_str").$gsub(/\s/,"").$delete("\0");var output=[];if("U*"==format&&"UTF-8"===this.internal_encoding.name&&"function"==typeof this.codePointAt){var j=0;output=new Array(this.length);for(var i=offset;i<this.length;i++)(output[j++]=this.codePointAt(i))>65535&&i++;return output.slice(0,j)}var buffer=this.$bytes();$truthy($rb_gt(offset,buffer.$length()))&&$Kernel.$raise($$$("ArgumentError"),"offset outside of string"),buffer=buffer.slice(offset);var optimizedHandler=optimized[format];if(optimizedHandler)return optimizedHandler(buffer);return eachDirectiveAndCount(format,(function(directive,count){var part=function(directive,count){var chunk,chunkReader=readChunk[directive];null==chunkReader&&$Kernel.$raise("Unsupported unpack directive "+directive.$inspect()+" (no chunk reader defined)");var chunkData=chunkReader(buffer,count);chunk=chunkData.chunk,buffer=chunkData.rest;var handler=handlers[directive];return null==handler&&$Kernel.$raise("Unsupported unpack directive "+directive.$inspect()+" (no handler defined)"),handler(chunk)}(directive,count);if(count!==1/0){var shouldAutocomplete=autocompletion[directive];null==shouldAutocomplete&&$Kernel.$raise("Unsupported unpack directive "+directive.$inspect()+" (no autocompletion rule defined)"),shouldAutocomplete&&function(array,size){for(;array.length<size;)array.push(nil)}(part,count)}output=output.concat(part)})),output}),-2),$def(self,"$unpack1",(function(format,$kwargs){var offset;return null==(offset=($kwargs=$ensure_kwargs($kwargs)).$$smap.offset)&&(offset=0),format=$Opal["$coerce_to!"](format,$$$("String"),"to_str").$gsub(/\s/,"").$delete("\0"),this.$unpack(format["$[]"](0),$hash2(["offset"],{offset:offset}))["$[]"](0)}),-2)}(0,0,[])},Opal.modules["corelib/marshal"]=function(Opal){var $module=Opal.module,$const_set=Opal.const_set,$def=Opal.def,$alias=Opal.alias,self=Opal.top,$$$=(Opal.nil,Opal.$$$);return Opal.add_stubs("require,write,new,read,load"),self.$require("corelib/marshal/read_buffer"),self.$require("corelib/marshal/write_buffer"),function($base,$parent_nesting){var self=$module("::","Marshal"),$nesting=[self].concat($parent_nesting);return $const_set($nesting[0],"MAJOR_VERSION",4),$const_set($nesting[0],"MINOR_VERSION",8),function(self,$parent_nesting){return $def(self,"$dump",(function(object){return $$$(this,"WriteBuffer").$new(object).$write()}),1),$def(self,"$load",(function(marshaled){return $$$(this,"ReadBuffer").$new(marshaled).$read()}),1),$alias(self,"restore","load")}(Opal.get_singleton_class(self))}(0,[])},Opal.modules["corelib/pack_unpack/format_string_parser"]=function(Opal){var self,directives,modifiers,$module=Opal.module,$Kernel=Opal.Kernel,$$$=(Opal.nil,Opal.$$$);return Opal.add_stubs("raise"),self=$module("::","PackUnpack"),directives=["C","S","L","Q","J","c","s","l","q","j","n","N","v","V","U","w","D","d","F","f","E","e","G","g","A","a","Z","B","b","H","h","u","M","m","P","p","@","X","x"],modifiers=["!","_",">","<"],void(self.eachDirectiveAndCount=function(format,callback){var currentDirective,currentCount,currentModifiers,countSpecified;function reset(){currentDirective=null,currentCount=0,currentModifiers=[],countSpecified=!1}function yieldAndReset(){null!=currentDirective?(!/[sSiIlLqQjJ]/.test(currentDirective)&&currentModifiers.length>0&&$Kernel.$raise($$$("ArgumentError"),"'"+currentModifiers[0]+"' allowed only after types sSiIlLqQjJ"),-1!==currentModifiers.indexOf("<")&&-1!==currentModifiers.indexOf(">")&&$Kernel.$raise($$$("RangeError"),"Can't use both '<' and '>'"),countSpecified||(currentCount=1),-1!==currentModifiers.indexOf(">")&&(currentDirective+=">"),callback(currentDirective,currentCount),reset()):reset()}reset();for(var i=0;i<format.length;i++){var currentChar=format[i];-1!==directives.indexOf(currentChar)?(yieldAndReset(),currentDirective=currentChar):currentDirective&&(/\d/.test(currentChar)?(currentCount=10*currentCount+parseInt(currentChar,10),countSpecified=!0):"*"===currentChar&&!1===countSpecified?(currentCount=1/0,countSpecified=!0):-1!==modifiers.indexOf(currentChar)&&!1===countSpecified?currentModifiers.push(currentChar):yieldAndReset())}yieldAndReset()})},Opal.modules.base64=function(Opal){var $module=Opal.module,$defs=Opal.defs,$ensure_kwargs=Opal.ensure_kwargs,$truthy=Opal.truthy,$nesting=[],nil=Opal.nil;return Opal.add_stubs("raise,delete"),function($base,$parent_nesting){var encode,decode,self=$module($base,"Base64"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return encode=function(input){for(var block,charCode,str=String(input),idx=0,map=chars,output="";str.charAt(0|idx)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8))(charCode=str.charCodeAt(idx+=3/4))>255&&self.$raise($$("ArgumentError"),"invalid character (failed: The string to be encoded contains characters outside of the Latin1 range.)"),block=block<<8|charCode;return output},decode=function(input){var str=String(input).replace(/=+$/,"");str.length%4==1&&self.$raise($$("ArgumentError"),"invalid base64 (failed: The string to be decoded is not correctly encoded.)");for(var bs,buffer,bc=0,idx=0,output="";buffer=str.charAt(idx++);~buffer&&(bs=bc%4?64*bs+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0)buffer=chars.indexOf(buffer);return output},$defs(self,"$decode64",(function(string){return decode(string.replace(/\r?\n/g,""))}),1),$defs(self,"$encode64",(function(string){return encode(string).replace(/(.{60})/g,"$1\n").replace(/([^\n])$/g,"$1\n")}),1),$defs(self,"$strict_decode64",(function(string){return decode(string)}),1),$defs(self,"$strict_encode64",(function(string){return encode(string)}),1),$defs(self,"$urlsafe_decode64",(function(string){return decode(string.replace(/\-/g,"+").replace(/_/g,"/"))}),1),$defs(self,"$urlsafe_encode64",(function(string,$kwargs){var padding,str=nil;return null==(padding=($kwargs=$ensure_kwargs($kwargs)).$$smap.padding)&&(padding=!0),str=encode(string).replace(/\+/g,"-").replace(/\//g,"_"),$truthy(padding)||(str=str.$delete("=")),str}),-2)}($nesting[0],$nesting)},Opal.modules["corelib/marshal/read_buffer"]=function(Opal){var $module=Opal.module,$klass=Opal.klass,$neqeq=Opal.neqeq,$Kernel=Opal.Kernel,$def=Opal.def,$ensure_kwargs=Opal.ensure_kwargs,$truthy=Opal.truthy,$rb_ge=Opal.rb_ge,$rb_plus=Opal.rb_plus,$hash2=Opal.hash2,$eqeq=Opal.eqeq,$rb_divide=Opal.rb_divide,$rb_times=Opal.rb_times,$send=Opal.send,$to_a=Opal.to_a,$Class=Opal.Class,$Module=Opal.Module,$rb_lt=Opal.rb_lt,$Object=Opal.Object,nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("attr_reader,to_s,read_byte,!=,raise,length,read_char,read_fixnum,read_float,read_bignum,read_string,read_symbol,read_cached_symbol,read_array,read_hash,read_hashdef,read_regexp,read_struct,read_class,read_module,read_object,read_cached_object,read_extended_object,read_primitive_with_ivars,read_user_class,read_user_defined,read_user_marshal,>=,[],+,==,/,to_f,<<,*,each,ord,**,to_i,symbols_cache,read,[]=,default=,new,safe_const_get,values_at,members,class,allocate,instance_variable_set,object_cache,extend,is_a?,any?,<,_load,marshal_load,const_get"),function($base,$parent_nesting){var self=$module("::","Marshal"),$nesting=[self].concat($parent_nesting);return function($base,$super,$parent_nesting){var self=$klass($base,null,"ReadBuffer"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),$proto=self.$$prototype;return $proto.buffer=$proto.index=$proto.object_cache=nil,self.$attr_reader("version","buffer","index","object_cache","symbols_cache"),$def(self,"$initialize",(function(input){var major,minor;return this.buffer=function(string){var i,singleByte,l=string.length,result=[];for(i=0;i<l;i++)singleByte=string.charCodeAt(i),result.push(singleByte);return result}(input.$to_s()),this.index=0,major=this.$read_byte(),minor=this.$read_byte(),($neqeq(major,$$("MAJOR_VERSION"))||$neqeq(minor,$$("MINOR_VERSION")))&&$Kernel.$raise($$$("TypeError"),"incompatible marshal file format (can't be read)"),this.version=major+"."+minor,this.object_cache=[],this.symbols_cache=[],this.ivars=[]}),1),$def(self,"$length",(function(){return this.buffer.$length()}),0),$def(self,"$read",(function($kwargs){switch(null==($kwargs=$ensure_kwargs($kwargs)).$$smap.cache&&!0,this.$read_char()){case"0":return nil;case"T":return!0;case"F":return!1;case"i":return this.$read_fixnum();case"f":return this.$read_float();case"l":return this.$read_bignum();case'"':return this.$read_string();case":":return this.$read_symbol();case";":return this.$read_cached_symbol();case"[":return this.$read_array();case"{":return this.$read_hash();case"}":return this.$read_hashdef();case"/":return this.$read_regexp();case"S":return this.$read_struct();case"c":return this.$read_class();case"m":return this.$read_module();case"o":return this.$read_object();case"@":return this.$read_cached_object();case"e":return this.$read_extended_object();case"I":return this.$read_primitive_with_ivars();case"C":return this.$read_user_class();case"u":return this.$read_user_defined();case"U":return this.$read_user_marshal();case"M":return $Kernel.$raise($$$("NotImplementedError"),"ModuleOld type cannot be demarshaled yet");case"d":return $Kernel.$raise($$$("NotImplementedError"),"Data type cannot be demarshaled");default:return $Kernel.$raise($$$("ArgumentError"),"dump format error")}}),-1),$def(self,"$read_byte",(function(){var result;return $truthy($rb_ge(this.index,this.$length()))&&$Kernel.$raise($$$("ArgumentError"),"marshal data too short"),result=this.buffer["$[]"](this.index),this.index=$rb_plus(this.index,1),result}),0),$def(self,"$read_char",(function(){return String.fromCharCode(this.$read_byte())}),0),$def(self,"$read_fixnum",(function(){var x,i,c=(128^this.$read_byte())-128;if(0===c)return 0;if(c>0){if(4<c&&c<128)return c-5;for(x=0,i=0;i<c;i++)x|=this.$read_byte()<<8*i}else{if(-129<c&&c<-4)return c+5;for(c=-c,x=-1,i=0;i<c;i++)x&=~(255<<8*i),x|=this.$read_byte()<<8*i}return x}),0),$def(self,"$read_float",(function(){var result,s=nil;return s=this.$read_string($hash2(["cache"],{cache:!1})),result=$eqeq(s,"nan")?$rb_divide(0,0):$eqeq(s,"inf")?$rb_divide(1,0):$eqeq(s,"-inf")?$rb_divide(-1,0):s.$to_f(),this.object_cache["$<<"](result),result}),0),$def(self,"$read_bignum",(function(){var sign,size,result=nil;return sign=$eqeq(this.$read_char(),"-")?-1:1,size=$rb_times(this.$read_fixnum(),2),result=0,$send(Opal.Range.$new(0,size,!0),"each",[],(function $$1(exp){return null==exp&&(exp=nil),result=$rb_plus(result,$rb_times((null==$$1.$$s?this:$$1.$$s).$read_char().$ord(),2["$**"]($rb_times(exp,8))))}),{$$arity:1,$$s:this}),result=$rb_times(result.$to_i(),sign),this.object_cache["$<<"](result),result}),0),$def(self,"$read_string",(function($kwargs){var cache,length;null==(cache=($kwargs=$ensure_kwargs($kwargs)).$$smap.cache)&&(cache=!0),length=this.$read_fixnum();var i,result="";for(i=0;i<length;i++)result+=this.$read_char();return cache&&this.object_cache.push(result),result}),-1),$def(self,"$read_symbol",(function(){var length;length=this.$read_fixnum();var i,result="";for(i=0;i<length;i++)result+=this.$read_char();return this.symbols_cache.push(result),result}),0),$def(self,"$read_cached_symbol",(function(){return this.$symbols_cache()["$[]"](this.$read_fixnum())}),0),$def(self,"$read_array",(function(){var length,result=nil;if(result=[],this.object_cache["$<<"](result),(length=this.$read_fixnum())>0)for(;result.length<length;)result.push(this.$read());return result}),0),$def(self,"$read_hash",(function($kwargs){var cache,result,length,key,value,i;if(null==(cache=($kwargs=$ensure_kwargs($kwargs)).$$smap.cache)&&(cache=!0),result=$hash2([],{}),$truthy(cache)&&this.object_cache["$<<"](result),(length=this.$read_fixnum())>0)for(i=0;i<length;i++)key=this.$read(),value=this.$read(),$send(result,"[]=",[key,value]);return result}),-1),$def(self,"$read_hashdef",(function(){var default_value,hash=nil;return hash=this.$read_hash(),default_value=this.$read(),hash["$default="](default_value),hash}),0),$def(self,"$read_regexp",(function(){var string,options,result;return string=this.$read_string($hash2(["cache"],{cache:!1})),options=this.$read_byte(),result=$$$("Regexp").$new(string,options),this.object_cache["$<<"](result),result}),0),$def(self,"$read_struct",(function(){var klass_name,attributes,args,result,klass=nil;return klass_name=this.$read($hash2(["cache"],{cache:!1})),klass=this.$safe_const_get(klass_name),attributes=this.$read_hash($hash2(["cache"],{cache:!1})),args=$send(attributes,"values_at",$to_a(klass.$members())),result=$send(klass,"new",$to_a(args)),this.object_cache["$<<"](result),result}),0),$def(self,"$read_class",(function(){var klass_name,result=nil;return klass_name=this.$read_string($hash2(["cache"],{cache:!1})),result=this.$safe_const_get(klass_name),$eqeq(result.$class(),$Class)||$Kernel.$raise($$$("ArgumentError"),klass_name+" does not refer to a Class"),this.object_cache["$<<"](result),result}),0),$def(self,"$read_module",(function(){var mod_name,result=nil;return mod_name=this.$read_string($hash2(["cache"],{cache:!1})),result=this.$safe_const_get(mod_name),$eqeq(result.$class(),$Module)||$Kernel.$raise($$$("ArgumentError"),mod_name+" does not refer to a Module"),this.object_cache["$<<"](result),result}),0),$def(self,"$read_object",(function(){var klass_name,ivars,klass=nil,object=nil;return klass_name=this.$read($hash2(["cache"],{cache:!1})),klass=this.$safe_const_get(klass_name),object=klass.$allocate(),this.object_cache["$<<"](object),ivars=this.$read_hash($hash2(["cache"],{cache:!1})),$send(ivars,"each",[],(function(name,value){return null==name&&(name=nil),null==value&&(value=nil),$eqeq(name["$[]"](0),"@")?object.$instance_variable_set(name,value):object[name]=value}),2),object}),0),$def(self,"$read_cached_object",(function(){return this.$object_cache()["$[]"](this.$read_fixnum())}),0),$def(self,"$read_extended_object",(function(){var mod,object=nil;return mod=this.$safe_const_get(this.$read()),(object=this.$read()).$extend(mod),object}),0),$def(self,"$read_primitive_with_ivars",(function(){var object=nil,primitive_ivars=nil;return object=this.$read(),primitive_ivars=this.$read_hash($hash2(["cache"],{cache:!1})),$truthy(primitive_ivars["$any?"]())&&$truthy(object["$is_a?"]($$("String")))&&(object=new String(object)),$send(primitive_ivars,"each",[],(function(name,value){return null==name&&(name=nil),null==value&&(value=nil),$neqeq(name,"E")?object.$instance_variable_set(name,value):nil}),2),object}),0),$def(self,"$read_user_class",(function(){var klass_name,value,result,klass=nil;return klass_name=this.$read($hash2(["cache"],{cache:!1})),klass=this.$safe_const_get(klass_name),value=this.$read($hash2(["cache"],{cache:!1})),result=$truthy($rb_lt(klass,$$("Hash")))?klass["$[]"](value):klass.$new(value),this.object_cache["$<<"](result),result}),0),$def(self,"$read_user_defined",(function(){var klass_name,data,result,klass=nil;return klass_name=this.$read($hash2(["cache"],{cache:!1})),klass=this.$safe_const_get(klass_name),data=this.$read_string($hash2(["cache"],{cache:!1})),result=klass.$_load(data),this.object_cache["$<<"](result),result}),0),$def(self,"$read_user_marshal",(function(){var klass_name,data,result=nil;return klass_name=this.$read($hash2(["cache"],{cache:!1})),result=this.$safe_const_get(klass_name).$allocate(),this.object_cache["$<<"](result),data=this.$read($hash2(["cache"],{cache:!1})),result.$marshal_load(data),result}),0),$def(self,"$safe_const_get",(function(const_name){try{return $Object.$const_get(const_name)}catch($err){if(!Opal.rescue($err,[$$$("NameError")]))throw $err;try{return $Kernel.$raise($$$("ArgumentError"),"undefined class/module "+const_name)}finally{Opal.pop_exception()}}}),1)}(self,0,$nesting)}(0,[])},Opal.modules["corelib/marshal/write_buffer"]=function(Opal){var self,$klass=Opal.klass,$def=Opal.def,$truthy=Opal.truthy,$rb_lt=Opal.rb_lt,$rb_ge=Opal.rb_ge,$Kernel=Opal.Kernel,$send=Opal.send,$module=Opal.module,$eqeqeq=Opal.eqeqeq,$Module=Opal.Module,$Class=Opal.Class,$BasicObject=Opal.BasicObject,$rb_gt=Opal.rb_gt,$rb_divide=Opal.rb_divide,$not=Opal.not,$rb_minus=Opal.rb_minus,$Object=Opal.Object,$rb_plus=Opal.rb_plus,$nesting=[],nil=Opal.nil,$$$=Opal.$$$;return Opal.add_stubs("append,<,>=,write_fixnum,write_bignum,save_link,write_float,write_ivars_prefix,write_extends,write_user_class,write_string,write_array,write_ivars_suffix,default_proc,raise,default,write_hash,write,write_regexp,class,name,write_module,singleton_class?,write_class,write_object,append_symbol,exclude_end?,begin,end,length,each_pair,attr_reader,new,[]=,version,index,object_id,write_object_link,respond_to?,write_usr_marshal,write_userdef,===,__marshal__,call,bind,instance_method,>,-@,<<,&,floor,/,size,each,to_s,options,equal?,!,empty?,instance_variables,instance_variable_get,reject,ancestors,singleton_class,is_a?,-,marshal_dump,+,_dump"),self=$klass("::",null,"NilClass"),$def(self,"$__marshal__",(function(buffer){return buffer.$append("0")}),1),function($base,$super){var self=$klass("::",null,"Boolean");$def(self,"$__marshal__",(function(buffer){return $truthy(1==this)?buffer.$append("T"):buffer.$append("F")}),1)}(),function($base,$super){var self=$klass("::",null,"Integer");$def(self,"$__marshal__",(function(buffer){return $rb_ge(this,-1073741824)&&$rb_lt(this,1073741824)?(buffer.$append("i"),buffer.$write_fixnum(this)):(buffer.$append("l"),buffer.$write_bignum(this))}),1)}(),function($base,$super){var self=$klass("::",null,"Float");$def(self,"$__marshal__",(function(buffer){return buffer.$save_link(this),buffer.$append("f"),buffer.$write_float(this)}),1)}(),function($base,$super){var self=$klass("::",null,"String");$def(self,"$__marshal__",(function(buffer){return buffer.$save_link(this),buffer.$write_ivars_prefix(this),buffer.$write_extends(this),buffer.$write_user_class($$$("String"),this),buffer.$append('"'),buffer.$write_string(this)}),1)}(),function($base,$super){var self=$klass("::",null,"Array");$def(self,"$__marshal__",(function(buffer){return buffer.$save_link(this),buffer.$write_ivars_prefix(this),buffer.$write_extends(this),buffer.$write_user_class($$$("Array"),this),buffer.$append("["),buffer.$write_array(this),buffer.$write_ivars_suffix(this)}),1)}(),function($base,$super,$parent_nesting){var self=$klass("::",null,"Hash"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting);$def(self,"$__marshal__",(function(buffer){return $truthy(this.$default_proc())&&$Kernel.$raise($$$("TypeError"),"can't dump hash with default proc"),buffer.$save_link(this),buffer.$write_ivars_prefix(this),buffer.$write_extends(this),buffer.$write_user_class($$("Hash"),this),$truthy(this.$default())?(buffer.$append("}"),buffer.$write_hash(this),buffer.$write(this.$default())):(buffer.$append("{"),buffer.$write_hash(this)),buffer.$write_ivars_suffix(this)}),1)}(0,0,$nesting),function($base,$super){var self=$klass("::",null,"Regexp");$def(self,"$__marshal__",(function(buffer){return buffer.$save_link(this),buffer.$write_ivars_prefix(this),buffer.$write_extends(this),buffer.$write_user_class($$$("Regexp"),this),buffer.$append("/"),buffer.$write_regexp(this),buffer.$write_ivars_suffix(this)}),1)}(),function($base,$super){var self=$klass("::",null,"Proc");$def(self,"$__marshal__",(function(buffer){return $Kernel.$raise($$$("TypeError"),"no _dump_data is defined for class "+this.$class())}),1)}(),function($base,$super){var self=$klass("::",null,"Method");$def(self,"$__marshal__",(function(buffer){return $Kernel.$raise($$$("TypeError"),"no _dump_data is defined for class "+this.$class())}),1)}(),function($base,$super){var self=$klass("::",null,"MatchData");$def(self,"$__marshal__",(function(buffer){return $Kernel.$raise($$$("TypeError"),"no _dump_data is defined for class "+this.$class())}),1)}(),function($base,$super){var self=$klass("::",null,"Module");$def(self,"$__marshal__",(function(buffer){return $truthy(this.$name())||$Kernel.$raise($$$("TypeError"),"can't dump anonymous module"),buffer.$save_link(this),buffer.$append("m"),buffer.$write_module(this)}),1)}(),function($base,$super){var self=$klass("::",null,"Class");$def(self,"$__marshal__",(function(buffer){return $truthy(this.$name())||$Kernel.$raise($$$("TypeError"),"can't dump anonymous class"),$truthy(this["$singleton_class?"]())&&$Kernel.$raise($$$("TypeError"),"singleton class can't be dumped"),buffer.$save_link(this),buffer.$append("c"),buffer.$write_class(this)}),1)}(),function($base,$super){var self=$klass("::",null,"BasicObject");$def(self,"$__marshal__",(function(buffer){return buffer.$save_link(this),buffer.$write_extends(this),buffer.$append("o"),buffer.$write_object(this)}),1)}(),function($base,$super){var self=$klass("::",null,"Range");$def(self,"$__marshal__",(function(buffer){return buffer.$save_link(this),buffer.$write_extends(this),buffer.$append("o"),buffer.$append_symbol(this.$class().$name()),buffer.$write_fixnum(3),buffer.$append_symbol("excl"),buffer.$write(this["$exclude_end?"]()),buffer.$append_symbol("begin"),buffer.$write(this.$begin()),buffer.$append_symbol("end"),buffer.$write(this.$end())}),1)}(),function($base,$super){var self=$klass("::",null,"Struct");$def(self,"$__marshal__",(function(buffer){return buffer.$save_link(this),buffer.$write_ivars_prefix(this),buffer.$write_extends(this),buffer.$append("S"),buffer.$append_symbol(this.$class().$name()),buffer.$write_fixnum(this.$length()),$send(this,"each_pair",[],(function(attr_name,value){return null==attr_name&&(attr_name=nil),null==value&&(value=nil),buffer.$append_symbol(attr_name),buffer.$write(value)}),2),buffer.$write_ivars_suffix(this)}),1)}(),function($base,$parent_nesting){var self=$module("::","Marshal"),$nesting=[self].concat($parent_nesting);return function($base,$super,$parent_nesting){var self=$klass($base,null,"WriteBuffer"),$nesting=[self].concat($parent_nesting),$$=Opal.$r($nesting),$proto=self.$$prototype;return $proto.object=$proto.cache=$proto.buffer=nil,self.$attr_reader("buffer"),$def(self,"$initialize",(function(object){return this.object=object,this.buffer="",this.cache=[],this.extends=$send($$$("Hash"),"new",[],(function(h,k){var $a;return null==h&&(h=nil),null==k&&(k=nil),$send(h,"[]=",$a=[k,[]]),$a[$a.length-1]}),2),this.$append(this.$version())}),1),$def(self,"$write",(function(object){var idx,s,$ret_or_1=nil;return null==object&&(object=this.object),$truthy(idx=this.cache.$index(object.$object_id()))?this.$write_object_link(idx):$truthy(object["$respond_to?"]("marshal_dump"))?this.$write_usr_marshal(object):$truthy(object["$respond_to?"]("_dump"))?this.$write_userdef(object):$eqeqeq(nil,$ret_or_1=object)||$eqeqeq(!0,$ret_or_1)||$eqeqeq(!1,$ret_or_1)||$eqeqeq($$$("Proc"),$ret_or_1)||$eqeqeq($$$("Method"),$ret_or_1)||$eqeqeq($$$("MatchData"),$ret_or_1)||$eqeqeq($$$("Range"),$ret_or_1)||$eqeqeq($$$("Struct"),$ret_or_1)||$eqeqeq($$$("Array"),$ret_or_1)||$eqeqeq($Class,$ret_or_1)||$eqeqeq($Module,$ret_or_1)||$eqeqeq($$$("Hash"),$ret_or_1)||$eqeqeq($$$("Regexp"),$ret_or_1)?object.$__marshal__(this):$eqeqeq($$$("Integer"),$ret_or_1)?$$$("Integer").$instance_method("__marshal__").$bind(object).$call(this):$eqeqeq($$$("Float"),$ret_or_1)?$$$("Float").$instance_method("__marshal__").$bind(object).$call(this):$eqeqeq($$$("String"),$ret_or_1)?$$$("String").$instance_method("__marshal__").$bind(object).$call(this):$BasicObject.$instance_method("__marshal__").$bind(object).$call(this),s=this.buffer,(s=new String(s)).encoding=$$$($$("Encoding"),"BINARY"),s}),-1),$def(self,"$write_fixnum",(function(n){var s;if(0==n)s=String.fromCharCode(n);else if(n>0&&n<123)s=String.fromCharCode(n+5);else if(n<0&&n>-124)s=String.fromCharCode(256+n-5);else{s="";for(var l_byte,cnt=0,i=0;i<4;i++){var b=255&n;if(s+=String.fromCharCode(b),cnt+=1,0===(n>>=8)||-1===n)break}l_byte=n<0?256-cnt:cnt,s=String.fromCharCode(l_byte)+s}this.$append(s)}),1),$def(self,"$write_bignum",(function(n){var sign,num=nil,arr=nil;for(sign=$truthy($rb_gt(n,0))?"+":"-",this.$append(sign),num=$truthy($rb_gt(n,0))?n:n["$-@"](),arr=[];$truthy($rb_gt(num,0));)arr["$<<"](num["$&"](65535)),num=$rb_divide(num,65536).$floor();return this.$write_fixnum(arr.$size()),$send(arr,"each",[],(function $$3(x){var self=null==$$3.$$s?this:$$3.$$s;return null==x&&(x=nil),self.$append(String.fromCharCode(255&x)),self.$append(String.fromCharCode($rb_divide(x,256).$floor()))}),{$$arity:1,$$s:this})}),1),$def(self,"$write_string",(function(s){return this.$write_fixnum(s.$length()),this.$append(s)}),1),$def(self,"$append_symbol",(function(sym){return this.$append(":"),this.$write_fixnum(sym.$length()),this.$append(sym)}),1),$def(self,"$write_array",(function(a){return this.$write_fixnum(a.$length()),$send(a,"each",[],(function $$4(item){return null==item&&(item=nil),(null==$$4.$$s?this:$$4.$$s).$write(item)}),{$$arity:1,$$s:this})}),1),$def(self,"$write_hash",(function(h){return this.$write_fixnum(h.$length()),$send(h,"each",[],(function $$5(key,value){var self=null==$$5.$$s?this:$$5.$$s;return null==key&&(key=nil),null==value&&(value=nil),self.$write(key),self.$write(value)}),{$$arity:2,$$s:this})}),1),$def(self,"$write_object",(function(obj){return this.$append_symbol(obj.$class().$name()),this.$write_ivars_suffix(obj,!0)}),1),$def(self,"$write_class",(function(klass){return this.$write_string(klass.$name())}),1),$def(self,"$write_module",(function(mod){return this.$write_string(mod.$name())}),1),$def(self,"$write_regexp",(function(regexp){return this.$write_string(regexp.$to_s()),this.$append(String.fromCharCode(regexp.$options()))}),1),$def(self,"$write_float",(function(f){return $truthy(f["$equal?"]($$$($$$("Float"),"INFINITY")))?this.$write_string("inf"):$truthy(f["$equal?"]($$$($$$("Float"),"INFINITY")["$-@"]()))?this.$write_string("-inf"):$truthy(f["$equal?"]($$$($$$("Float"),"NAN")))?this.$write_string("nan"):this.$write_string(f.$to_s())}),1),$def(self,"$write_ivars_suffix",(function(object,force){return null==force&&(force=!1),$truthy(object.$instance_variables()["$empty?"]())&&$not(force)?nil:(this.$write_fixnum(object.$instance_variables().$length()),$send(object.$instance_variables(),"each",[],(function $$6(ivar_name){var self=null==$$6.$$s?this:$$6.$$s;return null==ivar_name&&(ivar_name=nil),self.$append_symbol(ivar_name),self.$write(object.$instance_variable_get(ivar_name))}),{$$arity:1,$$s:this}))}),-2),$def(self,"$write_extends",(function(object){var singleton_mods,class_mods,own_mods=nil;return singleton_mods=$send(object.$singleton_class().$ancestors(),"reject",[],(function(mod){return null==mod&&(mod=nil),mod["$is_a?"]($$("Class"))}),1),class_mods=$send(object.$class().$ancestors(),"reject",[],(function(mod){return null==mod&&(mod=nil),mod["$is_a?"]($$("Class"))}),1),own_mods=$rb_minus(singleton_mods,class_mods),$truthy(own_mods["$empty?"]())?nil:$send(own_mods,"each",[],(function $$9(mod){var self=null==$$9.$$s?this:$$9.$$s;return null==mod&&(mod=nil),self.$append("e"),self.$append_symbol(mod.$name())}),{$$arity:1,$$s:this})}),1),$def(self,"$write_user_class",(function(klass,object){return $truthy(object.$class()["$equal?"](klass))?nil:(this.$append("C"),this.$append_symbol(object.$class().$name()))}),2),$def(self,"$write_object_link",(function(idx){return this.$append("@"),this.$write_fixnum(idx)}),1),$def(self,"$save_link",(function(object){return this.cache["$<<"](object.$object_id())}),1),$def(self,"$write_usr_marshal",(function(object){var value,klass,namespace=nil;return value=object.$marshal_dump(),klass=object.$class(),this.$append("U"),namespace=klass.$$base_module,$truthy(namespace["$equal?"]($Object))?this.$append_symbol(klass.$$name):this.$append_symbol($rb_plus($rb_plus(namespace.$name(),"::"),klass.$$name)),this.$write(value)}),1),$def(self,"$write_userdef",(function(object){var value=nil;return value=object.$_dump(0),$truthy(value["$is_a?"]($$$("String")))||$Kernel.$raise($$$("TypeError"),"_dump() must return string"),this.$write_ivars_prefix(value),this.$append("u"),this.$append_symbol(object.$class().$name()),this.$write_string(value)}),1),$def(self,"$write_ivars_prefix",(function(object){return $truthy(object.$instance_variables()["$empty?"]())?nil:this.$append("I")}),1),$def(self,"$append",(function(s){return this.buffer+=s}),1),$def(self,"$version",(function(){return String.fromCharCode($$("MAJOR_VERSION"),$$("MINOR_VERSION"))}),0)}(self,0,$nesting)}(0,$nesting)},Opal.queue((function(Opal){var $Object=Opal.Object;Opal.nil;return Opal.add_stubs("autoload,require"),$Object.$autoload("Marshal","corelib/marshal"),$Object.$require("corelib/string/unpack"),$Object.$require("corelib/array/pack"),$Object.$autoload("ObjectSpace","corelib/object_space"),$Object.$require("corelib/pattern_matching/base"),$Object.$autoload("PatternMatching","corelib/pattern_matching"),$Object.$autoload("TracePoint","corelib/trace_point")}));
